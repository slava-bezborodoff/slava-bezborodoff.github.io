<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.8.6">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2020-04-18T15:30:57+03:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Slava Bezborodov</title><subtitle>My journey in the world.</subtitle><entry><title type="html">Meet Peter Markov</title><link href="http://localhost:4000/meet/people/2019/11/09/peter-markov.html" rel="alternate" type="text/html" title="Meet Peter Markov" /><published>2019-11-09T11:51:00+03:00</published><updated>2019-11-09T11:51:00+03:00</updated><id>http://localhost:4000/meet/people/2019/11/09/peter-markov</id><content type="html" xml:base="http://localhost:4000/meet/people/2019/11/09/peter-markov.html">&lt;style type=&quot;text/css&quot;&gt;
  h2 {
    font-size: 20pt;
  }
  h3 {
    font-size: 10pt;
    font-weight: bold;
  }
  .company {
    font-size: 19pt;
  }
  .job {
    font-size: 16pt;
    color: gray;
  }
  .epigraph-wrapper {
    width: auto;
    overflow: hidden;
  }
  .epigraph {
    margin-top: 3em;
    font-style: italic;
    text-align: right;
    width: 60%;
    float: right;
  }
  .img {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width: 50%;
  }
  .img-title {
    font-style: italic;
    text-align: center;
  }
  .videoWrapper {
    position: relative;
    padding-bottom: 56.25%; /* 16:9 */
    padding-top: 25px;
    height: 0;
  }
  .videoWrapper iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
&lt;/style&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/peter-markov/0065.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;div class=&quot;company&quot;&gt;CIAN&lt;/div&gt;
&lt;div class=&quot;job&quot;&gt;Director of Regional Development&lt;/div&gt;

&lt;hr /&gt;

&lt;div class=&quot;epigraph-wrapper&quot;&gt;
  &lt;div class=&quot;epigraph&quot;&gt;
    &lt;p&gt;'tis better to do and repent than to forbear and repent.&lt;/p&gt;
    &lt;p&gt;Niccolò Machiavelli&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&quot;about-moscow&quot;&gt;About Moscow&lt;/h2&gt;

&lt;h3 id=&quot;are-you-from-moscow&quot;&gt;Are you from Moscow?&lt;/h3&gt;

&lt;p&gt;No, like almost everybody here. I came to Moscow in 2003.&lt;/p&gt;

&lt;h3 id=&quot;how-do-you-like-moscow&quot;&gt;How do you like Moscow?&lt;/h3&gt;

&lt;p&gt;Moscow was much worse in 2003. The former mayor Luzhkov was strongly focused on construction and thought less about the city’s development. In 2010, Sobyanin became a mayor. His success is based on 2-3 key things.&lt;/p&gt;

&lt;p&gt;First, Sobyanin, as a protege, was able to agree with the federal government on partial financing of projects. In Moscow 15 new subway stations are being built per year, while in Nizhny Novgorod only 1 station in 15 years. In many ways, everything is built on federal money. In fact, the Moscow subway is built by the whole country. And all the big projects related to it.&lt;/p&gt;

&lt;p&gt;Second, it seems that they set themselves the task to build a comfortable environment. Make Moscow as the European capital for which you are not ashamed. And any visiting foreigner will say: “Wow! Yes, it’s not worse here than in Vienna, in London or in Paris!”. And probably already better than in Paris.&lt;/p&gt;

&lt;p&gt;I think they did a great job. As always, there is no limit to perfection. But now it’s much better. I like this progression.&lt;/p&gt;

&lt;h3 id=&quot;is-moscow-a-city-of-justice&quot;&gt;Is Moscow a city of justice?&lt;/h3&gt;

&lt;p&gt;I don’t know what justice is. It really depends on, because everyone has their own justice.&lt;/p&gt;

&lt;p&gt;Justice depends on norms. Norms depend on customs, traditions and culture. Therefore, by definition, justice is not absolute, but relative. There are age, social, cultural and religious differences. Different people want to build different justice. Is it fair to chop off a hand for stealing according to Sharia? No one knows. It seems strange to me, but I think someone could argue with me. Therefore, the word justice is an object for discussion.&lt;/p&gt;

&lt;h2 id=&quot;about-origin&quot;&gt;About origin&lt;/h2&gt;

&lt;h3 id=&quot;where-did-you-come-from&quot;&gt;Where did you come from?&lt;/h3&gt;

&lt;p&gt;I was born and raised in &lt;a href=&quot;https://en.wikipedia.org/wiki/Samarkand&quot;&gt;Samarkand, Uzbekistan&lt;/a&gt;. It is quite an ancient city. As far as I know, the second or third oldest. All the time there is a competition for the title of the oldest there.&lt;/p&gt;

&lt;p class=&quot;img-title&quot;&gt;&lt;a href=&quot;https://commons.wikimedia.org/wiki/File:Afrosiab_(8145369219).jpg#/media/Файл:Afrosiab_(8145369219).jpg&quot;&gt;&lt;img src=&quot;https://upload.wikimedia.org/wikipedia/commons/d/dc/Afrosiab_%288145369219%29.jpg&quot; alt=&quot;Afrosiab (8145369219).jpg&quot; /&gt;&lt;/a&gt;&lt;br /&gt;Author: &lt;a rel=&quot;nofollow&quot; class=&quot;external text&quot; href=&quot;https://www.flickr.com/people/79721788@N00&quot;&gt;David Stanley&lt;/a&gt; from Nanaimo, Canada - &lt;a rel=&quot;nofollow&quot; class=&quot;external text&quot; href=&quot;https://www.flickr.com/photos/davidstanleytravel/8145369219/&quot;&gt;Afrosiab&lt;/a&gt;, &lt;a href=&quot;https://creativecommons.org/licenses/by/2.0&quot; title=&quot;Creative Commons Attribution 2.0&quot;&gt;CC BY 2.0&lt;/a&gt;, &lt;a href=&quot;https://commons.wikimedia.org/w/index.php?curid=24200001&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There are oases and mountains. The city is surrounded by mountains, and in the middle is a valley. The city is well closed on all sides from the wind.&lt;/p&gt;

&lt;p&gt;I haven’t been there since I left. Perhaps I’ll be back, but as a tourist, because there is no one who I would like to see.&lt;/p&gt;

&lt;h3 id=&quot;what-is-your-education&quot;&gt;What is your education?&lt;/h3&gt;

&lt;p&gt;I finished school in &lt;a href=&quot;https://en.wikipedia.org/wiki/Mozdok&quot;&gt;Mozdok&lt;/a&gt; - this is North Ossetia-Alania, on the border with Chechnya. And then in 2003 I went to study in Moscow, as I originally wanted. I studied at &lt;a href=&quot;https://en.wikipedia.org/wiki/Moscow_State_Aviation_Technological_University&quot;&gt;MATI&lt;/a&gt; — Russian State Technological University, which is now a part of the &lt;a href=&quot;https://en.wikipedia.org/wiki/Moscow_Aviation_Institute&quot;&gt;MAI&lt;/a&gt; – the Moscow Aviation Institute and does not exist as a separate university. I studied as an engineer. I have bachelor and master degrees and even an incomplete graduate student diploma.&lt;/p&gt;

&lt;p&gt;I gave up on graduate school at the moment when I realized that proposed dissertation topic was complete bullshit. The supervisor was 76 years old, and he chose “passing” topics – understandable to others 76-year-old. With such a topic, you were guaranteed to defend a dissertation, but then you would feel really uncomfortable.&lt;/p&gt;

&lt;p&gt;In undergraduate school I studied to be an electronic engineer. I learned how to solder boards, how to design devices using the constructor and how to start producing them. I worked at &lt;a href=&quot;https://en.wikipedia.org/wiki/Elektronika_Central_Scientific_Research_Institute&quot;&gt;Elektronika&lt;/a&gt; Central Scientific Research Institute. We made GLONASS satellites there. And some part of my work even flew somewhere and didn’t explode into the sea – it’s still flying! The satellites are handmade, because they aren’t alike. Some of them are even made by different teams.&lt;/p&gt;

&lt;p&gt;The engineering is close sphere to me, known and interesting. But in 2010, I decided to stop working in this field. The reason, probably, was the understanding that &lt;em&gt;I want to work more with people&lt;/em&gt;. And soldering the boards dulls me a little. I can solder, but this is futile.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;I understood that there is another world in which life beats. This was a dynamic IT world.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I have a story about how I worked in the company for only a day. And it’s even recorded in my workbook. It was a factory with walk-throughs and a toilet outside the perimeter of the tariffed area. Everything was at its worst. I went to work and got a little lost. It was really funny. I was 3 minutes late, and I was fined 500 rubles. On my first working day.&lt;/p&gt;

&lt;p&gt;I sat at my workplace. A man came and gave me an electronic board and told me to figure out how it works. I figured it out in 15 minutes. He just brought some pieces of shit like from a vacuum cleaner. I drew such boards when I was a sophomore. Everything was clear. One microcontroller and something else. He didn’t even have to leave.&lt;/p&gt;

&lt;p&gt;I went up to him and said that I had already figured it out. And he said that this was my assignment for a week. He wanted me to figure this out for a whole week! And now he needs to assign something new for me.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;In fact, after you were hired, it no longer mattered what you were doing. It is really demotivating. Perhaps this was the last straw.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I realized that this sucks. In 2009, I decided that something needed to be changed. And since 2010 I started work as a project manager in a web studio for any money to do anything with zero experience.&lt;/p&gt;

&lt;h2 id=&quot;about-art&quot;&gt;About art&lt;/h2&gt;

&lt;h3 id=&quot;what-is-your-favorite-film-director&quot;&gt;What is your favorite film director?&lt;/h3&gt;

&lt;p&gt;I have no one. And I have no favorite film. Different stages of life call for different aspects. Each stage has its own film. These films were supposed to appear exactly at the time to impress me.&lt;/p&gt;

&lt;p&gt;I don’t really like the Marvel franchise. I understand why this is commercially successful, why the sequels or re-shoots are successful. Marvel has a budget, and the more films they make, the better. But in this way they take money away from sane movies, and it upsets me.&lt;/p&gt;

&lt;p&gt;Of the latter, I liked Interstellar. And the greatest resonance was caused by Game of Thrones.&lt;/p&gt;

&lt;h3 id=&quot;and-what-about-books&quot;&gt;And what about books?&lt;/h3&gt;

&lt;p&gt;I read a lot in my childhood. But I read much more less now. I always liked science fiction.&lt;/p&gt;

&lt;p&gt;In Samarkand I went to the library. I was a regular reader. Everyone knew me there and did not ask my number. I read the entire science fiction shelf. And I was waiting for somebody to return books that I had not read. It seems I could even get involved in looking for people who did not return the rest of the books.&lt;/p&gt;

&lt;p&gt;I remember, I was very impressed with the trilogy of Vasily Yan &lt;a href=&quot;https://ru.wikipedia.org/wiki/%D0%9D%D0%B0%D1%88%D0%B5%D1%81%D1%82%D0%B2%D0%B8%D0%B5_%D0%BC%D0%BE%D0%BD%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2_(%D0%B8%D1%81%D1%82%D0%BE%D1%80%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B0%D1%8F_%D1%82%D1%80%D0%B8%D0%BB%D0%BE%D0%B3%D0%B8%D1%8F)&quot;&gt;“Invasion of the Mongols”&lt;/a&gt;. As far as I understand history now, there were historical inconsistencies there. The trilogy was not untrue, rather exaggerated. The main exaggeration is the number of Mongol-Tatars who attacked Russia.&lt;/p&gt;

&lt;p&gt;Is there a book that you think is required to read?
I find it difficult to advise any books and films. All the knowledge that I get can be represented as a library. Let’s imagine, one kind robot takes a new book, parses it into meanings and carries it to the library. He throws out the meanings which are already there - this is something already known. Those meanings that somehow enrich my knowledge - he puts in the appropriate cells. And I almost always forget what specific meaning was taken from. Just my network is enriched.&lt;/p&gt;

&lt;p&gt;It happens that new knowledge does not fit into any cells. They don’t fit because I simply don’t have such a shelf - this is not in the context of my life now. Or they don’t fit because they don’t completely correspond to what I already know. Then a new fact is either completely eliminated, or it forces me to look for even more literature in order to understand what is correct. In fact, books and films remain at the level of some generalized knowledge.&lt;/p&gt;

&lt;p&gt;Sophisticated books can well be splitted into thoughts, which can then be used later. And after you understand it, for some reason it becomes obvious to you. And since it is obvious, it is not clear how you can recommend the obvious things? In fact - advise nonsense. But this is not nonsense. It is really difficult to recommend anything when you do not know at what level of development a person is.&lt;/p&gt;

&lt;h2 id=&quot;about-work&quot;&gt;About work&lt;/h2&gt;

&lt;h3 id=&quot;do-you-use-any-methods-from-triz-or-lateral-thinking&quot;&gt;Do you use any methods from TRIZ or Lateral Thinking?&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/TRIZ&quot;&gt;TRIZ&lt;/a&gt; is a good thing, I am familiar with it, but I don’t use it in my daily work and don’t solve these problems. There are many specific instrumental things in TRIZ. I read &lt;a href=&quot;https://en.wikipedia.org/wiki/Lateral_thinking&quot;&gt;Lateral Thinking&lt;/a&gt;. But I won’t say that this book has changed something. It just once again enriched my world. This is surprising, but applied problems can often be solved without understanding the world at all.&lt;/p&gt;

&lt;p&gt;There is such a term in HR called &lt;a href=&quot;https://en.wiktionary.org/wiki/wideness&quot;&gt;wideness&lt;/a&gt; – when a person has not one, but several skills. There is another term called &lt;a href=&quot;https://en.wikipedia.org/wiki/T-shaped_skills&quot;&gt;T-shaped&lt;/a&gt; - when you have super skills for one particular job. Now it is considered useful for business for people to be T-shaped. But for the people themselves, it seems to me very useful to be wide, and know different things, and look at different angles.&lt;/p&gt;

&lt;p&gt;I think that sooner or later we will reach logical things anyway, the only question is when it will happen.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;There is no complicated nor simple. There is understandable and misunderstandable.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The problem with social interactions is that everyone should buy your idea. And this means that everyone should understand quickly. As long as everyone doesn’t accept this idea, the most intelligent one can explain it for a very long time, but they won’t buy it. He will have to wait until they see everything for themselves. Moreover, after some time he shouldn’t have to sell all of these, for them &lt;em&gt;it will become obvious&lt;/em&gt;. At some point, everything becomes obvious.&lt;/p&gt;

&lt;h3 id=&quot;is-it-hard-to-speak-at-conferences&quot;&gt;Is it hard to speak at conferences?&lt;/h3&gt;

&lt;p&gt;I was preparing for the first conference for a long time. It was Agile Days. It took me 80 hours along with a trip to Agile Days. Because I’m a nerd of it. It includes classes with a coach. Preparing for the next conferences was easier.&lt;/p&gt;

&lt;p class=&quot;videoWrapper&quot;&gt;
&lt;iframe width=&quot;966&quot; height=&quot;543&quot; src=&quot;https://www.youtube.com/embed/A3eRZsbaQDg&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;
&lt;/p&gt;

&lt;p&gt;I drew a presentation with designers. I painted on a piece of paper. I went to some conference just with scanned sheets. And it went even better than a presentation from designers. The only thing that is technically difficult to do is transitions.&lt;/p&gt;

&lt;p&gt;In my opinion, presentations are almost evil. I don’t really like presentations. We are really used to them. I try to make presentations that you won’t understand without my speech. I do this on purpose, not to annoy others, but to prevent people from reading from the slides. Then they are forced to listen to me. This is such a manipulative method.&lt;/p&gt;

&lt;h3 id=&quot;how-do-you-relax-from-work&quot;&gt;How do you relax from work?&lt;/h3&gt;

&lt;p&gt;I often walk around Sokolniki Park, get to Oleniye Prudy. I like the park, it is well decorated. At weekends, I can cycle far to Losinyy Ostrov park. I don’t go in for winter sports because of my Samarkand origin. Probably, I should someday try. But I really like summer sports.&lt;/p&gt;

&lt;p class=&quot;img-title&quot;&gt;&lt;a href=&quot;https://commons.wikimedia.org/wiki/File:Levitan_Sokolniki_Autumn_1879.jpg#/media/File:Levitan_Sokolniki_Autumn_1879.jpg&quot;&gt;&lt;img class=&quot;img&quot; src=&quot;https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Levitan_Sokolniki_Autumn_1879.jpg/1200px-Levitan_Sokolniki_Autumn_1879.jpg&quot; alt=&quot;Levitan Sokolniki Autumn 1879.jpg&quot; /&gt;&lt;/a&gt;&lt;br /&gt;Autumn day. Sokolniki. 1879. By &lt;a href=&quot;https://en.wikipedia.org/wiki/en:Isaac_Levitan&quot; class=&quot;extiw&quot; title=&quot;w:en:Isaac Levitan&quot;&gt;Isaac Levitan&lt;/a&gt; - &lt;a rel=&quot;nofollow&quot; class=&quot;external text&quot; href=&quot;https://www.tretyakovgallery.ru/en/collection/osenniy-den-sokolniki/&quot;&gt;Tretyakov Gallery&lt;/a&gt;, Public Domain, &lt;a href=&quot;https://commons.wikimedia.org/w/index.php?curid=237913&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Honestly, I don’t know the answer to this question. I’m looking for it, but haven’t found yet. The most important what I came to is to listen to the body and not to get worked up.&lt;/p&gt;

&lt;p&gt;I am a person with high demands on myself. High self-demands allow to demand this from the others.&lt;/p&gt;

&lt;p&gt;I can force myself to do almost everything if necessary. Get up at 6, start doing something, go to bed at 11 and then get up at 6 again, etc. It’s ok when you’re on a roll. The key thing is to ensure that you’re on a roll. The greatest mental destruction occurs when something fails.&lt;/p&gt;

&lt;p&gt;Physical fatigue is completely different. Sport helps to get rid of physical fatigue. In sports you almost never get tired physically. In total, you recover very much. Here is the balance in which I go to the gym for group classes almost every day. It’s not really stressful when you do it often, it’s almost a zero entry threshold. You just come at the right time and then they just tell you what to do. Perfect!&lt;/p&gt;

&lt;p&gt;With mental fatigue, it is very important not to allow such an overload when you get the feeling that you work all the time through force and you don’t like what you do. At this moment you need to listen to yourself and do something. Find out why you don’t like it. Maybe you need to change jobs. Maybe you need to change your occupation.&lt;/p&gt;

&lt;h2 id=&quot;about-changes&quot;&gt;About changes&lt;/h2&gt;

&lt;h3 id=&quot;goldratt-in-his-book-called-the-goal-states-that-in-order-to-change-something-you-are-to-answer-3-questions-what-to-change-what-to-change-to-and-how-to-cause-the-change-how-do-you-make-your-changes&quot;&gt;Goldratt in his book called “The Goal” states that in order to change something you are to answer 3 questions: “What to change?”, “What to change to?” and “How to cause the change?”. How do you make your changes?&lt;/h3&gt;

&lt;p&gt;I would say this is the minimum set. Usually you are to answer even more questions.&lt;/p&gt;

&lt;p&gt;How to change? This is a question to double check that:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;you are able to do it,&lt;/li&gt;
  &lt;li&gt;you have enough resources to do it, and&lt;/li&gt;
  &lt;li&gt;you have enough time to do it.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In my opinion, there are 3 resources in human life - &lt;em&gt;money&lt;/em&gt;, &lt;em&gt;time&lt;/em&gt; and &lt;em&gt;energy&lt;/em&gt;. It’s hard to convert it one another, but it’s possible. You can buy time for money, buy money for time, buy energy for money, etc.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Now the main limitation&lt;/strong&gt; (of my life and the life of people in my environment) &lt;strong&gt;is not time nor money, but energy&lt;/strong&gt;. Not time, because it is the same for everyone - 24 hours. Not money, because I mean money sufficient for recovery, for a full life, etc. But what really hinders reaching big things is &lt;em&gt;energy&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;All changes must be based on something. And they are always based on people. In the end, both the object and the subject are people. This is a really important understanding.&lt;/p&gt;

&lt;p class=&quot;img-title&quot;&gt;&lt;a href=&quot;https://commons.wikimedia.org/wiki/File:Karl_Marx_001.jpg#/media/File:Karl_Marx_001.jpg&quot;&gt;&lt;img class=&quot;img&quot; src=&quot;https://upload.wikimedia.org/wikipedia/commons/thumb/d/d4/Karl_Marx_001.jpg/1200px-Karl_Marx_001.jpg&quot; alt=&quot;Karl Marx 001.jpg&quot; /&gt;&lt;/a&gt;&lt;br /&gt;Portrait of Karl Marx (1818–1883). By &lt;a href=&quot;https://en.wikipedia.org/wiki/en:John_Jabez_Edwin_Mayall&quot; class=&quot;extiw&quot; title=&quot;w:en:John Jabez Edwin Mayall&quot;&gt;John Jabez Edwin Mayal&lt;/a&gt; - &lt;a href=&quot;https://en.wikipedia.org/wiki/en:International_Institute_of_Social_History&quot; class=&quot;extiw&quot; title=&quot;w:en:International Institute of Social History&quot;&gt;International Institute of Social History&lt;/a&gt;, Public Domain, &lt;a href=&quot;https://commons.wikimedia.org/w/index.php?curid=591288&quot;&gt;Link&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Marx had the postulate that &lt;em&gt;everything around us is labor&lt;/em&gt;. That is, this phone is essentially the labor of people who assembled it from parts. Some people made this electronics. Someone made glass, someone built a factory with which they made glass, someone mined ore, someone made trucks, etc. If you expand this chain far enough (it is pretty long in our economy today), &lt;em&gt;at the end of any chain there will be not money, but a person&lt;/em&gt;. A person who invested his time in some kind of action. It means that the start and the end point of any change is a person.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;In your changes, you yourself are the starting point.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;First check if you have enough energy to make a change. If you don’t have energy, nothing will change. Then you verify that the system is ready for change. If the system is not ready for change, then it will resist. You are to understand what kind of environment is in the system and why this resistance exists.&lt;/p&gt;

&lt;p&gt;Resistance usually comes down to a very small number of things. For example, people hold the status quo because, as it seems to them, they have a risk of losing their jobs. Thus, you find all these risks. In fact, you cannot find all the risks because they are invisible. The more experienced the person, the more and deeper he sees. I guess my depth of seeing the things is also limited and there is probably a lot of things that I do not see.&lt;/p&gt;

&lt;p&gt;After that, you are to understand &lt;em&gt;the objective function&lt;/em&gt; - this is the most important. And also, where are you now relative to the point that you need to reach and with what tools you are going to reach it.&lt;/p&gt;

&lt;p&gt;For example, we want to change the effectiveness of people. There are two options in the simplest case.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;The same people do more work and achieve bigger goals.&lt;/li&gt;
  &lt;li&gt;Achieve the same goals, but with fewer people, which means lower costs.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Both goals are actually good and the objective function is known - it’s efficiency.&lt;/p&gt;

&lt;p&gt;But efficiency is really difficult to measure. I thought about it for a long time and found not any answer. What is the level of effectiveness now? Is it 5.6 or 6.2? And what was the level of efficiency yesterday? And what should be the level of effectiveness? &lt;em&gt;And what is efficiency&lt;/em&gt;?&lt;/p&gt;

&lt;p&gt;Efficiency is easy to measure when you have a benchmark. You pick a number, declare it 100%, call it efficiency and see how effective you are. For example, producing 800 discs is a lot or a little? Who knows? But if Toyota releases 1000, then 800 means 0.8 or 80%. So, guys, tense up and do more. But everyone who publishes benchmarks is always lying, because it’s really challenging to create a good benchmark.&lt;/p&gt;

&lt;p&gt;Let’s say we need to compare people within the company. We publish a benchmark (our expectations) that the rating should be at least 3. Accordingly, we declare all people who get less than 3 bad, and those who are more - good. But as soon as we published this benchmark, questions immediately arise for such a rating system.&lt;/p&gt;

&lt;p&gt;One person works in a team with high requirements, he is rated lower because the level of expectations is high. And in the other team, everyone loves each other and give you 4 simply for the fact that you sometimes come to work. And it is not clear how to normalize this. Using this benchmark, you declare a person bad, and maybe the opposite is true at all. This is very vicious. In fact, there are no benchmarks.&lt;/p&gt;

&lt;p&gt;The benchmark cannot claim that the developer has to release 17 tasks a week. This benchmark very much depends on granularity, on the deployment process, on how the system is structured, etc.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;I could not determine what efficiency is. After consulting with more intelligent colleagues, we also found nothing.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Therefore, I proposed to measure the effectiveness with known measure of inefficiency. That is, to assume from the opposite that there is an ideally efficient process, we cannot measure it in numbers. But we can understand that regarding it we already see a bunch of leaks, inefficiencies. And if we detail these inefficiencies, somehow weigh them one opposite the others, it will not be an absolute scale, which we have not found, but relative. We can find the weaknesses and begin to correct them consistently.&lt;/p&gt;

&lt;p&gt;There is one dangerous trap in this approach. These inefficiencies cyclically depend on one another, like energy, money, and time. That is, you say, “I have little energy”. You’ll rush as much as possible to have a lot of energy. But in the end you have neither time nor money left. And you cannot move on. And all the time you fall into the fact that you give everything to only one thing, but in fact you go around in circles. The key fact is to ask yourself from time to time if you are in this cycle or not.&lt;/p&gt;

&lt;p&gt;It is important to vote for such problems and solve them in working groups. This is not an ideal system, like any other democratic system. But as practice shows, it is much better to do something that everyone believes in, even if it’s not the most paramount, than the most paramount, which is unpleasant for everyone.&lt;/p&gt;

&lt;h2 id=&quot;about-goals&quot;&gt;About goals&lt;/h2&gt;

&lt;h3 id=&quot;how-not-to-be-afraid-of-ambitious-goals&quot;&gt;How not to be afraid of ambitious goals?&lt;/h3&gt;

&lt;p&gt;There is no answer to this question. How not to be afraid? The answer is obvious - do not be afraid. I think this is a wrong question. Need to be afraid. Because fear is some kind of emotion, you just need to be able to fear right. No need to panic.&lt;/p&gt;

&lt;p&gt;I have it somehow internally built-in. I always create a discomfort zone for myself. I keep challenging myself artificially.&lt;/p&gt;

&lt;p&gt;You can do well-known things for good money. It’s probably not a bad way to do it, but it’s all the same without tension, simply because you get the feeling that it’s all simple. You give answers right from your head, no need to prepare, everything becomes obvious, and this simplifies life well. Someone is striving for this.&lt;/p&gt;

&lt;p&gt;For me it’s like a death. As soon as I feel it, I try to go back into the discomfort zone , artificially create it in any way. Through challenges, I guarantee that I am moving. I not only know it, but I guarantee it.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If you are under load all the time, you have only 2 exits. You either deal with it and that means you have grown. Or you burn.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Therefore, the question is not “How not to be afraid?”. The question is: “How to prevent fear from binding you?”. To be afraid is not scary. It is scary if you refuse to do something out of fear.&lt;/p&gt;

&lt;p&gt;Once I parachuted. And there was a girl who did not jump out of the plane. She had come a long way. She arrived at the airfield, she waited for a gigantic line, she listened to a very long briefing, took off on an airplane – and did not jump out. She spent a lot of time on this. And the wait for the jump, it seems to me, was the most stressful. Because jumping out was easy for me. But waiting way of  jump was stressful. And the climax ended in nothing.&lt;/p&gt;

&lt;p&gt;After that, I’m sure she returned to earth, the fear disappeared, and she thought: “Why didn’t I jump?”&lt;/p&gt;

&lt;h2 id=&quot;references&quot;&gt;References&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;a href=&quot;https://www.linkedin.com/in/pymark/&quot;&gt;Peter Markov&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Ph &lt;a href=&quot;https://vk.com/a.morkovkin&quot;&gt;Andrey Morkovkin&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Eng &lt;a href=&quot;https://vk.com/ksuakimova&quot;&gt;Ksyunchik Shamanaeva&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><summary type="html"></summary></entry><entry><title type="html">CASE Method: Function and Process Modelling</title><link href="http://localhost:4000/software/architecture/2019/05/11/case-method.html" rel="alternate" type="text/html" title="CASE Method: Function and Process Modelling" /><published>2019-05-11T12:26:00+03:00</published><updated>2019-05-11T12:26:00+03:00</updated><id>http://localhost:4000/software/architecture/2019/05/11/case-method</id><content type="html" xml:base="http://localhost:4000/software/architecture/2019/05/11/case-method.html">&lt;p&gt;&lt;img src=&quot;/assets/img/case-method/tree.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A critical success factor in developing computer-based systems is the effective modelling of business functions and processes.&lt;/p&gt;

&lt;h1 id=&quot;introduction&quot;&gt;Introduction&lt;/h1&gt;

&lt;p&gt;Function models are used to represent what a business does or needs to do, to meet it’s objectives and respond to events.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;A business function&lt;/strong&gt; is something that the business does or needs to do.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;An objective&lt;/strong&gt; is something quantifiable (you can measure it) and is something that the business has set out to achieve. The importance of business functions is made more visible when they are held to specific objectives.&lt;/li&gt;
  &lt;li&gt;Functions are arranged in &lt;strong&gt;a hierarchy&lt;/strong&gt;, with increasing detail of the lower levels; this is for convenience and as a navigation facility, giving a context to a function when it is being read (i.e. it needs to be done to achieve its parent function). This arrangement also helps us to check for completeness.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Events&lt;/strong&gt; are happenings, often external to the business, which trigger business functions.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Function models are constructed in a manner that is independent of any possible implementation mechanism or organization, and thus can be used for many years, even if the organization changes or new mechanisms are found. That is, we record &lt;strong&gt;what&lt;/strong&gt; the function is, not &lt;strong&gt;how&lt;/strong&gt; it is to be carried out.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Analyst must model what is done, not how it is done.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The aim is to produce a robust and rigorous model, free from details of the mechanisms for performing the functions. If these were included in the model they could prejudice the eventual choice of mechanisms, and would reduce the longevity of the model as it could be overtaken rapidly by technical change, even though the actual business content might still be valid.&lt;/p&gt;

&lt;p&gt;The interaction between business functions and the information model is important, we have to pay particular notice to whether a function creates, retrieves, updates or deletes information. A CASE tool is becoming more and more essential to handle the vast scale of important cross-related information.&lt;/p&gt;

&lt;p&gt;So function models are really useful ways of clearly describing what a business does so that users, analysts and system engineers can agree on the requirement. They are also independent of mechanisms or organization, and thus can be used for many years, even if the organization changes or new mechanisms are found.&lt;/p&gt;

&lt;h1 id=&quot;information-gaining&quot;&gt;Information Gaining&lt;/h1&gt;

&lt;p&gt;There are a lot of ways of gaining information about the organization under analysis and a number of sources from which functions can be found. But &lt;strong&gt;interviewing is recommended&lt;/strong&gt; as the primary source, with cross-checks from existing documentation, abservation, practical experience and generic hierarchies.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;A Word of Warning.&lt;/p&gt;

  &lt;p&gt;In some organizations internal politics are rife, so you need to be wary of the skilled manager (or perhaps we should use the term manipulator) deliberately feeding invalid data, which you might inadvertently use furthering the political intent of this person. Avoid getting involved in this type of activity, carefully cross-check key assertions and continually work on questioning techniques and other approaches that cut through the politics to find out what the business actually does or needs to do, as opposite to how the politics work.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;At this point in an analysis you may have hundreds of pages of notes, highlighted documents, mental images, and so on. You will already have done some consolidation to arrange the information into categories such as events, functions and entities. You will also have rewritten what you have been told (or understood) into unambiguous functions, which are independent of the organization structures, roles or mechanisms. Now you must turn these into a function model.&lt;/p&gt;

&lt;h1 id=&quot;the-function-hierarchy&quot;&gt;The Function Hierarchy&lt;/h1&gt;

&lt;p&gt;To construct a hierarchy from scratch, we start with initial interview notes and known business objectives and build a framework showing the essence of the business top down. The hierarchy is cross-checked and completed bottom up by taking detailed functions and fitting them into an appropriate place in the hierarchy, which will grow, evolve and change shape as the exercise proceeds.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Common functions&lt;/strong&gt; - when the same function appears in more than one place in a function hierarchy. They can be removed by escalating to a common parent, or recorded and cross-referenced by choosing one as a master. The frequency and urgency of a function can be recorded against each of organization, role, georgraphy and time period to guide a system designer towards sensible options for supporting the business in question.&lt;/p&gt;

&lt;p&gt;Of the six interrogative words, who, what, when, where, how and why, only the what and why should appear in a function model; the &lt;strong&gt;what&lt;/strong&gt; is an operation the business does, or needs to do, and the &lt;strong&gt;why&lt;/strong&gt; is the objective it is trying to achieve by doing it. Of the others:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;who&lt;/strong&gt; is extracted with the removal of jobs and roles;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;when&lt;/strong&gt; does not appear because functions have no implicit sequence or timing in the hierarchy;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;where&lt;/strong&gt; is removed when references to parts of the organization are taken out; and&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;how&lt;/strong&gt; is separated out with the removal of the mechanisms.&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;the-function-dependency&quot;&gt;The Function Dependency&lt;/h1&gt;

&lt;p&gt;The concept of &lt;strong&gt;a function dependency&lt;/strong&gt; recognizes that a function may have to wait on the completion of one or more other functions before it can be carried out itself. This dependency information can help us make decisions on such things as:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;the scope of a system,&lt;/li&gt;
  &lt;li&gt;the order in which systems can be developed,&lt;/li&gt;
  &lt;li&gt;the order in which functions within a system can be represented to the users of that system.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;function-dependency-diagrams&quot;&gt;Function Dependency Diagrams&lt;/h2&gt;

&lt;p&gt;Businesses everywhere spend much of their time reacting to external stimuli. &lt;strong&gt;Function dependency diagrams&lt;/strong&gt; are an easy-to-understand way of modelling what happens on receipt of an event, what functions are triggered and what key results are eventually achieved. The diagrams can be used for rigorously defining sequence, interdependency and functions that can be carried out in parallel at a business, system or program/procedure level. Diagrams at the high level are very good for agreeing the scope and sequencing of new systems with management. At the detailed level they must be used on leaf (lowest level) functions to maintain accuracy and are a useful modelling technique for functions that are oriented towards key results following external stimulation.&lt;/p&gt;

&lt;p&gt;Function dependency diagramming is another excellent technique to learn to help model the business requirement, communicate with users and build appropriate systems.&lt;/p&gt;

&lt;h1 id=&quot;detailed-function-definition&quot;&gt;Detailed Function Definition&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;An elementary function&lt;/strong&gt; is a function that &lt;em&gt;publishes&lt;/em&gt; the results of its actions in one go, or leaves the state of the information known to the business as it was before it started.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Function logic&lt;/strong&gt; is a way of defining precisely the information to be collected from the information model (by navigating around it), the processing to be carried out on that information, and the scope of any modifications to be made. A number of languages, with varying levels of rigour, are available for defining function logic.&lt;/p&gt;

&lt;p&gt;If the systems department is to be an integral part of your business and thus contribute towards its profitability, the exercise of defining functions and building systems &lt;strong&gt;must&lt;/strong&gt; be done in a pragmatic and cost-effective way. Too often we have seen &lt;strong&gt;purists&lt;/strong&gt; take elapsed years to define the detail requirement unambiguously prior to starting system design, frequently without user involvement. Meanwhile the business requirement may itself have changed!&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Don’t be like the person who buys an old house and wants it completely restored and perfect before inviting friends to dinner. By the time perfection is achieved your friends may have given up on you, moved house themselves, or even left the country.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;In general it is a far better to get the balance right and define requirements in sufficient detail to enable the designers and implementors to make a good job of it. Mistakes &lt;strong&gt;will&lt;/strong&gt; occur later, but prototyping and iteration based on a good starting point are cost-effective and timely ways of achieving the desired result.&lt;/p&gt;

&lt;h1 id=&quot;logical-system-design&quot;&gt;Logical System Design&lt;/h1&gt;

&lt;h2 id=&quot;dataflow-diagrams&quot;&gt;Dataflow Diagrams&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;The datastore&lt;/strong&gt; represents a persistent data storage capability and is expressed in terms of entities, attributes and relationships from the data model of the system.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The dataflow&lt;/strong&gt; shows a movement of data (again in terms of entities, attributes and relationships) between two processes, between a process and a datastore, or between a process and an external entity.&lt;/p&gt;

&lt;p&gt;Dataflows are called &lt;strong&gt;balanced&lt;/strong&gt; if they are into and out of processes that are not further decomposed. The task of decomposing a process and balancing its dataflows, by assigning them to its sub-processes, is a top-down design activity which, if taken to a low enough level of detail, can often form an adequate specification of a process from which final construction can take place (using a computer language, manual procedure, electronic circuit, etc.).&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;The dataflow diagramming&lt;/strong&gt; technique is, like many others, an iterative, evolutionary approach to arriving at the final result. Many mistakes will be made and repaired along the way to a completed system definition.&lt;/p&gt;

&lt;h2 id=&quot;realtime-modelling&quot;&gt;Realtime Modelling&lt;/h2&gt;

&lt;p&gt;Realtime modelling can be done using &lt;strong&gt;state transition diagramming&lt;/strong&gt;, which is another useful technique for modelling systems where it is important to know what happens when different events occur, dependent on the state of the system. These tend to be critical control systems, so it is important to be able to check them out with the user and using various quality checks. Realtime sub-systems are an essential component of many computer systems today, and become more and more important whenever process control and interactive graphics user interfaces are considered.&lt;/p&gt;

&lt;p&gt;State transition diagrams give us the ability to model a system from the viewpoint of the system being in a given state, going through a transition to another state following an event, and possibly carrying out some consequential process. They also allow us to model interrelated realtime sub-systems and handle queues and concurrent processes, and are particularly appropriate for process control systems and interactive graphical user interfaces.&lt;/p&gt;

&lt;h2 id=&quot;physical-system-design&quot;&gt;Physical System Design&lt;/h2&gt;

&lt;p&gt;Designing a system to a level of detail necessary for it to be built successfully demands design work to be done with knowledge of the physical implementation language, machinery or other implementation vehicle. The goal of the functional design activity is to design computerized systems that are:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;relevant,&lt;/li&gt;
  &lt;li&gt;usable, and&lt;/li&gt;
  &lt;li&gt;flexible.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Techniques such as decomposition, dependency and dataflow diagrams provide a good starting point for a physical design, and decomposition, in the form of a structure chart, can be used to record the results of a physical design for a procedural computer programming language.&lt;/p&gt;

&lt;h1 id=&quot;a-final-analogy&quot;&gt;A Final Analogy&lt;/h1&gt;

&lt;p&gt;As a final reminder about the importance of proper analysis and preparation throughout all the stages of creating information systems, let us consider the analogy of decorating a room in your home.&lt;/p&gt;

&lt;p&gt;It is spring and you get the urge to redecorate, so you rush out to the hardware shop and buy lots of lovely paint, wallpaper, new paint brushes, and so on. Then you come home and at least you have the sense to move the furniture out of the room or at least cover it up while you are working. A quick cup of tea (after all that rushing about) and you set to with the paint brush (it really is such fun painting you can’t wait to get to work). Result: you run out of paint, or you have loads left over, it is badly done, the cracks and the holes and the old flaking paint still show through, your children hate the colour!&lt;/p&gt;

&lt;p&gt;The &lt;em&gt;fun&lt;/em&gt; bit at the end will only be successful if you get the requirements and the design right - what colour, what type of paint, how much, will you still like the pattern in three years’ time? Then you must construct the system properly. Decide on the order of the preparation work: sanding the paintwork, preparing the walls, washing them, filling the cracks, and so on. Work out the order for the actual physical design: which bit will be painted first, how many coats of paint, how long between coats, and so on.&lt;/p&gt;

&lt;p&gt;Now you can actually start coding (painting).&lt;/p&gt;

&lt;h1 id=&quot;sources&quot;&gt;Sources&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Richard Barker, Cliff Longman.&lt;/strong&gt; Case*Method: Function and Process Modelling.&lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><summary type="html"></summary></entry><entry><title type="html">Game of Thrones: The Smartest Guy in Westeros</title><link href="http://localhost:4000/database/schema/sql/2019/04/27/got.html" rel="alternate" type="text/html" title="Game of Thrones: The Smartest Guy in Westeros" /><published>2019-04-27T17:37:23+03:00</published><updated>2019-04-27T17:37:23+03:00</updated><id>http://localhost:4000/database/schema/sql/2019/04/27/got</id><content type="html" xml:base="http://localhost:4000/database/schema/sql/2019/04/27/got.html">&lt;p&gt;&lt;img src=&quot;https://cdn.worldvectorlogo.com/logos/game-of-thrones.svg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://www.hbo.com/content/dam/hbodata/series/game-of-thrones/episodes/8/key-art/got-s8-ka-1920x1080.jpg/_jcr_content/renditions/cq5dam.web.1200.675.jpeg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;the-smartest-guy-in-westeros&quot;&gt;The Smartest Guy in Westeros&lt;/h1&gt;

&lt;h2 id=&quot;the-citadel-library&quot;&gt;The Citadel Library&lt;/h2&gt;

&lt;p&gt;There is the largest library in Westeros where Maesters can borrow issues of their favorite scientific magazines to read. Archmaester Ebrose is highly interested in the following questions.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Who doesn’t return magazine issues back?&lt;/li&gt;
  &lt;li&gt;What magazine is the most popular?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;He wants us to define a database schema with all the relations satisfying 3NF and answer the questions.&lt;/p&gt;

&lt;h2 id=&quot;winter-is-coming&quot;&gt;Winter is Coming&lt;/h2&gt;

&lt;p&gt;The first thing to begin with is to determine &lt;strong&gt;entities&lt;/strong&gt; out of the problem description and their &lt;strong&gt;relations&lt;/strong&gt; between each other. Moreover, we need to know &lt;strong&gt;attributes&lt;/strong&gt; of each entity to operate upon.&lt;/p&gt;

&lt;p&gt;We have the Citadel full of Maesters, who may want to use the library, i.e. to become a &lt;em&gt;user&lt;/em&gt;. We certainly are to track the readers and to know some basic things about them, e.g. their names. No surprise, the corresponding relation may look like that.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/got/users.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lets fill the table with some values.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Daenerys'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Sam'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Cersei'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Bran'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Sansa'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Sometimes Maesters can walk into the library and take one or more scientific &lt;em&gt;magazines&lt;/em&gt; to read.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/got/magazines.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lets add a couple of popular magazines to the library.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;magazines&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Mastering Dragons'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Westeros Geographic'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Wi-Fi Networks'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Magazines have concrete &lt;em&gt;issues&lt;/em&gt;. For example, the library may have 50 copies of the magazine’s April issue. Issues may be distinguished by one or more specific attributes, i.g. isbn number.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/got/issues.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lets fill it with values.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;issues&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;magazine_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;isbn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'978-3-16-148410-0'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'978-3-16-148410-1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'978-3-16-148410-2'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'978-3-16-148411-0'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'978-3-16-148411-1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'978-3-16-148411-2'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'978-3-16-148412-0'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'978-3-16-148412-1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'978-3-16-148412-2'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Maesters can borrow issues to read. Sad but true, some readers may not bring borrowed issues back. We want to track borrowed and returned issues in order to understand what we currently have in the library.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/got/operations.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Time goes by, and we have people coming to the library to take something to read.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;insert&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operations&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;issue_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;values&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'booked'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;	&lt;span class=&quot;c1&quot;&gt;-- Daenerys booked 978-3-16-148410-0 issue of Mastering Dragons magazine&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'booked'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;	&lt;span class=&quot;c1&quot;&gt;-- Sam booked 978-3-16-148411-0 issue of Westeros Geographic magazine&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'booked'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;	&lt;span class=&quot;c1&quot;&gt;-- Bran booked 978-3-16-148412-0 issue of Wi-Fi Networks magazine&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'available'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;	&lt;span class=&quot;c1&quot;&gt;-- Sam returned 978-3-16-148411-0 issue&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'booked'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;	&lt;span class=&quot;c1&quot;&gt;-- Sansa booked 978-3-16-148411-1 issue of Westeros Geographic magazine&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'booked'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;	&lt;span class=&quot;c1&quot;&gt;-- Sam booked 978-3-16-148410-2 issue of Mastering Dragons magazine&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'available'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;	&lt;span class=&quot;c1&quot;&gt;-- Daenerys returned 978-3-16-148410-0 issue&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'available'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;	&lt;span class=&quot;c1&quot;&gt;-- Sam returned 978-3-16-148410-2 issue&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'booked'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;	&lt;span class=&quot;c1&quot;&gt;-- Sam booked 978-3-16-148411-0 issue of Westeros Geographic magazine&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;So far, we have the following schema of library database. All the relations satisfy 3NF.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/got/er-diagram.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;when-you-play-a-game-of-thrones-you-win-or-you-die&quot;&gt;When You Play a Game of Thrones You Win or You Die&lt;/h2&gt;

&lt;p&gt;Now using defined schema lets try to answer Archmaester Ebrose questions.&lt;/p&gt;

&lt;p&gt;Who doesn’t return magazine issues back?&lt;/p&gt;

&lt;p&gt;The first thought coming to mind is to find the latest operation upon the issue made by user and check the type of that operation.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;issue_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operations&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;issue_id&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;latest&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operations&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;latest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'booked'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Using that query we can find that Bran, Sansa and Sam haven’t returned borrowed issues yet.&lt;/p&gt;

&lt;p&gt;Another approach is based on using two joins instead of subquery.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;users&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operations&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;booked&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;booked&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;booked&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'booked'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;left&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operations&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;returned&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;returned&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;returned&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'available'&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;returned&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;issue_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;booked&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;issue_id&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;returned&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;booked&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;having&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;booked&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;returned&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The result is the same.&lt;/p&gt;

&lt;p&gt;And what magazine is the most popular?&lt;/p&gt;

&lt;p&gt;We can find the issues which were booked sometime in the history. Then match the issues with the magazines and sort the result by number of bookings.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;booked_magazines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;magazine_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;booked_issues&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;issue_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operations&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'booked'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;issue_id&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;booked_issues&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;issues&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;booked_issues&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;issue_id&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;magazine_id&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;booked_magazines&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;magazines&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;booked_magazines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;magazine_id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;desc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;But this looks a little bit ugly and performs not so well. The thoughts may lead us to another pattern with no subqueries but with joins.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cnt&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;operations&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;issues&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;issue_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;magazines&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;magazine_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'booked'&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;op&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;m&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;desc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;if-i-look-back-i-am-lost&quot;&gt;If I Look Back I am Lost&lt;/h2&gt;

&lt;p&gt;Sam didn’t fall into a pattern of servitude at the Citadel, under the tutorial of Archmaester Ebrose, but healed greyscale of Jorah Mormont and discovered dragonglass on Dragonstone island. He did it, because he is the most talented reader in the Citadel library!&lt;/p&gt;

&lt;p&gt;Samwell Tarly, the honest Maesters ever, was feeling guilty and told Daenerys and Jorah Mormont that he had “borrowed” some books from the Citadel.&lt;/p&gt;

&lt;p&gt;The problem is that now the librarians know it too.&lt;/p&gt;</content><author><name></name></author><summary type="html"></summary></entry><entry><title type="html">How We Organized The First Internal CIAN Hackathon</title><link href="http://localhost:4000/team/building/2018/12/20/cian-internal-hackathon.html" rel="alternate" type="text/html" title="How We Organized The First Internal CIAN Hackathon" /><published>2018-12-20T07:25:12+03:00</published><updated>2018-12-20T07:25:12+03:00</updated><id>http://localhost:4000/team/building/2018/12/20/cian-internal-hackathon</id><content type="html" xml:base="http://localhost:4000/team/building/2018/12/20/cian-internal-hackathon.html">&lt;h1 id=&quot;how-we-organized-the-first-internal-cian-hackathon&quot;&gt;How We Organized The First Internal CIAN Hackathon&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/cian-internal-hackathon/img-10.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Large companies often face the same problems. The most common is communication. If departments are pretty isolated and try to talk to each other through the heads, leads and managers rather than directly, some team building event is here to come up, like internal hackathon for the programmers.&lt;/p&gt;

&lt;p&gt;CIAN has never had a hackathon before. We planned it as an event for teams, where each team has its name and leader. There are several points to notice here.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;We gave the teams freedom to find the members.&lt;/li&gt;
  &lt;li&gt;But we moderated this process slightly: teams were tend to find its members among their own departments. In that case we provided some help – broke that ice between departments and found a designer, or web developer, or data analyst that the team needed.&lt;/li&gt;
  &lt;li&gt;We kept in touch with this process and didn’t leave weak teams alone. We were like a bridge to different parts of the organization and continuously helped teams to make friendship. As the final result we got more happy teams and more social connections.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/cian-internal-hackathon/img-12.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;First of all, for the teams hackathon is a great opportunity:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;to come and make something new and interesting,&lt;/li&gt;
  &lt;li&gt;to get that project done for which there was no time,&lt;/li&gt;
  &lt;li&gt;to get feedback from the participants.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;The objectives&lt;/strong&gt; of our hackathon were:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;to improve horizontal communications in the company,&lt;/li&gt;
  &lt;li&gt;to find and inject new development tools and methods,&lt;/li&gt;
  &lt;li&gt;to get experience in organizing team building activities.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;The goals&lt;/strong&gt; were:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;to get 4-5 teams,&lt;/li&gt;
  &lt;li&gt;to get working MVP of the projects,&lt;/li&gt;
  &lt;li&gt;to filter the best projects and find out what to do with them.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Before we started, we were to make a decision on some key aspects. We didn’t want the first hackathon to last long. We planned 8 hours for coding, lunch and preparations and an hour to present the results. Again, we gave full freedom here: we had no one presentation template. Later, one of the winning team simply used  plain paper lists to present what they did.&lt;/p&gt;

&lt;p&gt;The working place had to be organized. It seemed ugly for us to work at where we usually work. We brought tables, chairs, laptops, electrical outlets and some music at one of our open spaces. It helped to provide good creative atmosphere to the participants.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/cian-internal-hackathon/img-5.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Infrastructure and deployment had to be defined too. It was very useful to invite system administrators: some teams had project-specific environment problems. There were lots of what to think about like awards and nominations, common chat and photographer, jury and warmup meeting (an involving meeting before the hackathon were we told about how it’s going to be and fed people). And pizza, of course.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/cian-internal-hackathon/img-8.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The folowwing roadmap was accepted.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Hold the warmup meeting – tell people why they should join the hackathon and feed them.&lt;/li&gt;
  &lt;li&gt;Collect project ideas.&lt;/li&gt;
  &lt;li&gt;Build the teams.&lt;/li&gt;
  &lt;li&gt;Hold the hackathon.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The day of the hackathon was scheduled like this.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Welcome reception and registration.&lt;/li&gt;
  &lt;li&gt;The beginning of the hackathon.&lt;/li&gt;
  &lt;li&gt;Lunch.&lt;/li&gt;
  &lt;li&gt;Teams’ presentation.&lt;/li&gt;
  &lt;li&gt;Jury work.&lt;/li&gt;
  &lt;li&gt;Winner’s reward ceremony.&lt;/li&gt;
  &lt;li&gt;End of the hackathon.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/cian-internal-hackathon/img-7.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We listed scoring criteria for jury. We gave 5 points to the project that perfectly matches the criteria, and 1 point if it didn’t match at all. We used 5 different criteria.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Project readiness – MVP works and carries its declared functions.&lt;/li&gt;
  &lt;li&gt;Project survival – The higher the probability of a project to survive in real life, the higher the score.&lt;/li&gt;
  &lt;li&gt;Project idea – The more original the idea is, the higher the score.&lt;/li&gt;
  &lt;li&gt;Project quality – The more completed, technological, logical and attractive the project is, the higher the score.&lt;/li&gt;
  &lt;li&gt;Project presentation – The better the team’s performance is, the higher the score.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/cian-internal-hackathon/img-6.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;What we got.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;7 teams.&lt;/li&gt;
  &lt;li&gt;About 35 people.&lt;/li&gt;
  &lt;li&gt;3 winning teams.&lt;/li&gt;
  &lt;li&gt;They rated us as high as 4.6 out of 5.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;What we provided.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The ability to communicate informally.&lt;/li&gt;
  &lt;li&gt;A chance to try new technologies and development tools.&lt;/li&gt;
  &lt;li&gt;An opportunity to be a part of a big family for remote teammates.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;What we did wrong.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Didn’t match the schedule, lacked a lot of time.&lt;/li&gt;
  &lt;li&gt;Couldn’t resolve infrastructure problems quickly.&lt;/li&gt;
  &lt;li&gt;Didn’t help the teams breathe life into the projects after the hackathon is ended.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/cian-internal-hackathon/img-13.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;That’s it. There are two recommendations to get your own hackathon done in your company.&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;There should be &lt;strong&gt;one person&lt;/strong&gt; responsible for the hackathon.&lt;/li&gt;
  &lt;li&gt;If there is a group of people responsible for the hackathon, there should be &lt;strong&gt;one person&lt;/strong&gt; responsible for the group.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Hackathon is a great team building event. Your HR will surely like it. Hold your hackathon, unite people and start gathering new ideas.&lt;/p&gt;

&lt;p&gt;Now!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/cian-internal-hackathon/img-14.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;</content><author><name></name></author><summary type="html">How We Organized The First Internal CIAN Hackathon</summary></entry><entry><title type="html">HighLoad++ 2018</title><link href="http://localhost:4000/programming/trends/2018/11/11/highload-2018.html" rel="alternate" type="text/html" title="HighLoad++ 2018" /><published>2018-11-11T17:53:06+03:00</published><updated>2018-11-11T17:53:06+03:00</updated><id>http://localhost:4000/programming/trends/2018/11/11/highload-2018</id><content type="html" xml:base="http://localhost:4000/programming/trends/2018/11/11/highload-2018.html">&lt;h1 id=&quot;highload-2018&quot;&gt;HighLoad++ 2018&lt;/h1&gt;

&lt;p&gt;&lt;img src=&quot;https://conf.python.ru/i/python_conf/2018/org_2018/hl.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This year &lt;a href=&quot;https://www.highload.ru/&quot;&gt;HighLoad++&lt;/a&gt; was held in Skolkovo, Moscow.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://www.highload.ru/i/highload/2018/general/bg-skolkovo.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This is my short notes about some of the conference reports. Abstracts of the other reports can be found &lt;a href=&quot;http://www.highload.ru/moscow/2018/abstracts&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#what-do-we-know-about-microservices&quot;&gt;What do we know about microservices?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#difficulties-of-containerized-applications-and-microservices&quot;&gt;Difficulties of containerized applications and microservices&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#a-way-to-realize-data-discovery-in-microservice-architecture&quot;&gt;A way to realize Data Discovery in microservice architecture&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#delayed-data-as-a-way-to-provide-consistency&quot;&gt;Delayed data as a way to provide consistency&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#search&quot;&gt;How search is organized in hh.ru&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#how-to-deal-with-techdebt&quot;&gt;How to deal with techdebt&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#infrastructure-development-in-badoo&quot;&gt;Infrastructure development in Badoo&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;what-do-we-know-about-microservices&quot;&gt;What do we know about microservices?&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;by Vadim Madison&lt;/em&gt;, &lt;a href=&quot;https://www.avito.ru&quot;&gt;Avito&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In microservice architecture we have:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;lots of services (&amp;gt; 100);&lt;/li&gt;
  &lt;li&gt;lots of repositories;&lt;/li&gt;
  &lt;li&gt;lots of teams that work separately;&lt;/li&gt;
  &lt;li&gt;disjoint contexts (nobody knows the truth);&lt;/li&gt;
  &lt;li&gt;data fragmentation.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;There should be a proper way to create, organize and maintain microservices to keep the whole system up to date.&lt;/p&gt;

&lt;h3 id=&quot;typical-microservice-pipeline&quot;&gt;Typical microservice pipeline&lt;/h3&gt;

&lt;h4 id=&quot;cli-push&quot;&gt;CLI-push&lt;/h4&gt;

&lt;p&gt;The first step is to create a service from scratch.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Create an app from the template. Provide templates for different languages.&lt;/li&gt;
  &lt;li&gt;Deploy DEV-environment on local machine by single CLI-command.&lt;/li&gt;
  &lt;li&gt;Connect to databases (no configuration is required).&lt;/li&gt;
  &lt;li&gt;Live-building: any changes in code made in IDE trigger rebuild machinary.&lt;/li&gt;
  &lt;li&gt;Generate autotest stubs.&lt;/li&gt;
  &lt;li&gt;Basic validation: documentation presence, dependencies, metrics and alerts (service owner decide what to monitor).&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;ci&quot;&gt;CI&lt;/h4&gt;

&lt;p&gt;Integrate the service into your environment.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Prepare a repository.&lt;/li&gt;
  &lt;li&gt;Generate pipeline in &lt;a href=&quot;https://www.jetbrains.com/teamcity/&quot;&gt;TeamCity&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;Grant required access.&lt;/li&gt;
  &lt;li&gt;Search the owner of the service (at least 2).&lt;/li&gt;
  &lt;li&gt;Register service in &lt;a href=&quot;https://atlas.hashicorp.com/&quot;&gt;Atlas&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;Migration checks: if the migration is probably dangerous, we will register a trigger in Atlas and put the migration into quarantine area.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;bake&quot;&gt;Bake&lt;/h4&gt;

&lt;p&gt;Prepare to deploy.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Create a &lt;a href=&quot;https://www.docker.com/&quot;&gt;docker&lt;/a&gt; image.&lt;/li&gt;
  &lt;li&gt;Generate &lt;a href=&quot;https://github.com/helm/charts&quot;&gt;Helm charts&lt;/a&gt;.&lt;/li&gt;
  &lt;li&gt;Create admin tickets to complete service-specific setup.&lt;/li&gt;
  &lt;li&gt;Run the tests and send coverage report to Atlas.&lt;/li&gt;
  &lt;li&gt;Check CPU and RAM requirements.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;deploy&quot;&gt;Deploy&lt;/h4&gt;

&lt;p&gt;Check the conventions.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Service’s endpoints.&lt;/li&gt;
  &lt;li&gt;Swagger schemas.&lt;/li&gt;
  &lt;li&gt;Format of logs.&lt;/li&gt;
  &lt;li&gt;Presence of required headers (X-Source-ID) in HTTP requests.&lt;/li&gt;
  &lt;li&gt;Presence X-Source-ID when communicate through the bus.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;test&quot;&gt;Test&lt;/h4&gt;

&lt;p&gt;Run unit tests.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Test in closed environment, no connections to external resources (&lt;a href=&quot;https://hoverfly.io/&quot;&gt;HoverFly&lt;/a&gt;).&lt;/li&gt;
  &lt;li&gt;Load testing.&lt;/li&gt;
  &lt;li&gt;Compare resource limits declared by service with real resource consumption. If the service consumes:
    &lt;ul&gt;
      &lt;li&gt;too low - check whether it’s killed by OOM killer;&lt;/li&gt;
      &lt;li&gt;too many - the service cannot be utilized.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;canary&quot;&gt;Canary&lt;/h4&gt;

&lt;p&gt;Test on real users.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;How many users - start canary testing from low percent of real users (&amp;lt; 0.1%).&lt;/li&gt;
  &lt;li&gt;How long to test:
    &lt;ul&gt;
      &lt;li&gt;5 mins (minimum);&lt;/li&gt;
      &lt;li&gt;2 hours (usual);&lt;/li&gt;
      &lt;li&gt;customize time for sophisticated services (monoliths).&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;What to check:
    &lt;ul&gt;
      &lt;li&gt;service-specific metrics;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;https://sentry.io&quot;&gt;Sentry&lt;/a&gt; errors;&lt;/li&gt;
      &lt;li&gt;response statuses;&lt;/li&gt;
      &lt;li&gt;response time (accurate and average);&lt;/li&gt;
      &lt;li&gt;latency;&lt;/li&gt;
      &lt;li&gt;exceptions (handled and unhandled);&lt;/li&gt;
      &lt;li&gt;… (lots of product metrics).&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;squeeze-testing&quot;&gt;Squeeze testing&lt;/h4&gt;

&lt;p&gt;Test by load.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Load 1 brick until it’s reached a point of failure.&lt;/li&gt;
  &lt;li&gt;Add +1 brick, load 2 bricks again and see delta.&lt;/li&gt;
  &lt;li&gt;Add +1 brick, load 3 bricks and see delta.&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
  &lt;li&gt;See the regression.&lt;/li&gt;
  &lt;li&gt;Use collected data to update or change service’s load testing configuration and send it to Atlas.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;documentation&quot;&gt;Documentation&lt;/h3&gt;

&lt;p&gt;Documentation has to be reviewed like any other codes!&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Service description - a few lines of what the service does.&lt;/li&gt;
  &lt;li&gt;A link to the architecture diagram.&lt;/li&gt;
  &lt;li&gt;Runbook - how to run the app, what preparation steps are required.&lt;/li&gt;
  &lt;li&gt;FAQ - list well-known issues.&lt;/li&gt;
  &lt;li&gt;API endpoints description.&lt;/li&gt;
  &lt;li&gt;Labels - links to a product, a team or a component (billing, filing form, etc.).&lt;/li&gt;
  &lt;li&gt;Owner(s) - fill manually or automatically.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;general&quot;&gt;General&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Auto scaling - not only by CPU or RAM, but by app-specific metrics.&lt;/li&gt;
  &lt;li&gt;Provide security updates - base images, libs and deps.&lt;/li&gt;
  &lt;li&gt;Warn about outdated services.&lt;/li&gt;
  &lt;li&gt;Consider to remove or aggregate services which used to be high loaded, but now have low traffic.&lt;/li&gt;
  &lt;li&gt;Provide a microservice dashboard with common metrics.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;difficulties-of-containerized-applications-and-microservices&quot;&gt;Difficulties of containerized applications and microservices&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;by Ivan Kruglov&lt;/em&gt;, &lt;a href=&quot;https://www.booking.com&quot;&gt;Booking.com&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For the last two years Booking.com has exploited three generations of private clouds including:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://mesos.apache.org/&quot;&gt;Apache Mesos&lt;/a&gt; + &lt;a href=&quot;https://mesosphere.github.io/marathon/&quot;&gt;Marathon&lt;/a&gt; (half a year),&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.openshift.com/&quot;&gt;OpenShift&lt;/a&gt; (a year),&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://kubernetes.io/&quot;&gt;Kubernetes&lt;/a&gt; (current).&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;marathon&quot;&gt;Marathon&lt;/h3&gt;

&lt;p&gt;Marathon took off as a hackathon, but the problem is that it’s still in that stage.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Bright Thought 1. Don’t underestimate the ability of code to survive.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;openshift&quot;&gt;OpenShift&lt;/h3&gt;

&lt;p&gt;OpenShift is shipped with Kubernetes. Booking.com used it along with &lt;a href=&quot;https://www.ansible.com/&quot;&gt;Ansible&lt;/a&gt; and &lt;a href=&quot;https://www.openvswitch.org/&quot;&gt;Open vSwitch&lt;/a&gt; because:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;it’s super cool;&lt;/li&gt;
  &lt;li&gt;network level isolation;&lt;/li&gt;
  &lt;li&gt;dynamic firewall holes.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The problem is - such a system is very hard to maintain. It’s obvious, but &lt;strong&gt;there is no cloud, it’s just someone else’s computer&lt;/strong&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Bright Thought 2. Cool vs. Boring.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Wanted:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Simple and convenient interface like in &lt;a href=&quot;https://www.heroku.com/&quot;&gt;Heroku&lt;/a&gt;: one button to solve all the problems.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Got:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Great first experience.&lt;/li&gt;
  &lt;li&gt;Confusion: what’s going on?&lt;/li&gt;
  &lt;li&gt;Hard debug of the problem apps.&lt;/li&gt;
  &lt;li&gt;Unhappy experienced users.&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;Bright Thought 3. Formulate user expectations from the system and system expections from the users.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Furthermore, it was hard to integrate that system to existed environment.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;DLB (distributed load balancing);&lt;/li&gt;
  &lt;li&gt;Service Discovery / Service Mesh;&lt;/li&gt;
  &lt;li&gt;Graphite;&lt;/li&gt;
  &lt;li&gt;Storage (&lt;a href=&quot;https://www.mysql.com/&quot;&gt;MySQL&lt;/a&gt;, &lt;a href=&quot;http://cassandra.apache.org/&quot;&gt;Cassandra&lt;/a&gt;, &lt;a href=&quot;https://redis.io/&quot;&gt;Redis&lt;/a&gt;, &lt;a href=&quot;https://kafka.apache.org/&quot;&gt;Kafka&lt;/a&gt;, …);&lt;/li&gt;
  &lt;li&gt;SSL certificates / identity key management;&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;Bright Thought 4. Kubernetes is good, but it’s integration with current environment is better! *&lt;/p&gt;

  &lt;p&gt;* If you don’t start from scratch.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The result of exploitation that system was:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;lots of help tickets;&lt;/li&gt;
  &lt;li&gt;users are waiting for magic without understanding the infrastructure;&lt;/li&gt;
  &lt;li&gt;loss of trust.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The plan to escape:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Minimum cool features.&lt;/li&gt;
  &lt;li&gt;Infrastructure monitoring.&lt;/li&gt;
  &lt;li&gt;Clear expectations from:
    &lt;ul&gt;
      &lt;li&gt;team,&lt;/li&gt;
      &lt;li&gt;users,&lt;/li&gt;
      &lt;li&gt;integration providers.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Investment in knowledge:
    &lt;ul&gt;
      &lt;li&gt;trainings,&lt;/li&gt;
      &lt;li&gt;courses,&lt;/li&gt;
      &lt;li&gt;docs,&lt;/li&gt;
      &lt;li&gt;books.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;kubernetes&quot;&gt;Kubernetes&lt;/h3&gt;

&lt;p&gt;Finally we’ve switched to Kubernetes, rejected some of the cool features (threw Ansible and Open vSwitch away) and realized proactive monitoring (we inform you, that we have a problem). After realization of the plan we’ve got:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;stable system;&lt;/li&gt;
  &lt;li&gt;~ 200 unique services + stable growth;&lt;/li&gt;
  &lt;li&gt;understanding of what’s going on;&lt;/li&gt;
  &lt;li&gt;fine-tuned interaction;&lt;/li&gt;
  &lt;li&gt;self service;&lt;/li&gt;
  &lt;li&gt;education system.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;a-way-to-realize-data-discovery-in-microservice-architecture&quot;&gt;A way to realize Data Discovery in microservice architecture&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;by Nikolay Golov&lt;/em&gt;, &lt;a href=&quot;https://www.avito.ru&quot;&gt;Avito&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In microservice architecture we use Database-per-service pattern instead of shared database.&lt;/p&gt;

&lt;p&gt;But in real systems we have a combination of patterns: Micro + Macro + Monolith + Shared Bases + DB-per-Service + … .&lt;/p&gt;

&lt;p&gt;The first step to split monolith app is to do &lt;a href=&quot;https://en.wikipedia.org/wiki/Domain_model&quot;&gt;domain modelling&lt;/a&gt; (get an image of how data is organized).&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Data Discovery&lt;/strong&gt; is a way to understand complexity of a continuously evolving system from data point of view and form actionable trends.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Digital_twin&quot;&gt;Digital Twin&lt;/a&gt; is an adequate way to get an image of the following difficulties.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;What services store what important data?&lt;/li&gt;
  &lt;li&gt;How important data transfer between services:
    &lt;ul&gt;
      &lt;li&gt;who creates it?&lt;/li&gt;
      &lt;li&gt;who copies it?&lt;/li&gt;
      &lt;li&gt;who removes it?&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Who can access what data?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The answer to these questions is a graph called &lt;strong&gt;Persistent Fabric&lt;/strong&gt;. The levels are:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;UI points,&lt;/li&gt;
  &lt;li&gt;API endpoints,&lt;/li&gt;
  &lt;li&gt;services,&lt;/li&gt;
  &lt;li&gt;storages,&lt;/li&gt;
  &lt;li&gt;teams,&lt;/li&gt;
  &lt;li&gt;persons,&lt;/li&gt;
  &lt;li&gt;hosts,&lt;/li&gt;
  &lt;li&gt;entities.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Each level should be actualized by using different sources.&lt;/p&gt;

&lt;p&gt;For example, to grant access to a database, we can query Persistent Fabric like that:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;-[get owner]-&amp;gt; Storage -[r/w access]-&amp;gt; Service -[owned by]-&amp;gt; Team -[leaded by]-&amp;gt; Person.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This graph can help to:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;find a subgraph for isolated testing,&lt;/li&gt;
  &lt;li&gt;prioritize monolith splitting,&lt;/li&gt;
  &lt;li&gt;loose coupling.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Different levels of the fabric should be filled by different people. For example, DBA fills Storage level, owner fills Service level and so on. Thanks to a single buffer, we can ask Persistent Fabric to compute:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;historical graph (changes),&lt;/li&gt;
  &lt;li&gt;current graph (now),&lt;/li&gt;
  &lt;li&gt;graph graph (real time API),&lt;/li&gt;
  &lt;li&gt;bus data streams graph,&lt;/li&gt;
  &lt;li&gt;UI points graph (user paths).&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;delayed-data-as-a-way-to-provide-consistency&quot;&gt;Delayed data as a way to provide consistency&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;by Andrey Litunenko&lt;/em&gt;, &lt;a href=&quot;http://info.2gis.com/&quot;&gt;2GIS&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In some sophisticated systems there may be the following problems:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;lots of imported data of different types,&lt;/li&gt;
  &lt;li&gt;subsystems publish data with different speed,&lt;/li&gt;
  &lt;li&gt;there are dependencies between the subsystems,&lt;/li&gt;
  &lt;li&gt;some items of data may be uploaded without its subitems,&lt;/li&gt;
  &lt;li&gt;backward compatibility is required on any schema changes.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;approach-10&quot;&gt;Approach 1.0&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Import system written on PHP.&lt;/li&gt;
  &lt;li&gt;In-house message delivery system.&lt;/li&gt;
  &lt;li&gt;Collecting data by cron.&lt;/li&gt;
  &lt;li&gt;Stubs for consistency.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;For instance, if entity attribute is received before the entity, we’ll create a stub for the entity. Later we’ll replace the stub with actual model.&lt;/p&gt;

&lt;p&gt;Negative results:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Duplicate key error on simultaneous inserting a stub and an entity (serial run of the commands may be a solution).&lt;/li&gt;
  &lt;li&gt;Slowing down on importing 8 mln records.&lt;/li&gt;
  &lt;li&gt;Shutting down on importing all the records.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;approach-20&quot;&gt;Approach 2.0&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Delayed data concept - put inconsistent data in separate table and wait until all the deps are received.&lt;/li&gt;
  &lt;li&gt;Notifications about outdated delayed data help to:
    &lt;ul&gt;
      &lt;li&gt;find internal problems,&lt;/li&gt;
      &lt;li&gt;find problems with external sources.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Apache Kafka:
    &lt;ul&gt;
      &lt;li&gt;Topics with all the change logs (store for 1 year).&lt;/li&gt;
      &lt;li&gt;Compacted topics with actual state (store forever).&lt;/li&gt;
      &lt;li&gt;Deduplication.&lt;/li&gt;
      &lt;li&gt;Re-read the partitions only for specific consumer.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://golang.org/&quot;&gt;Golang&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;summary&quot;&gt;Summary&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Draw data dependency.&lt;/li&gt;
  &lt;li&gt;Use delayed data to separate consistent and inconsistent data.&lt;/li&gt;
  &lt;li&gt;Provide backward compatibility on schema changes.&lt;/li&gt;
  &lt;li&gt;Think how to upload all data without a chance to shut down the whole system.&lt;/li&gt;
  &lt;li&gt;Run commands asynchronously.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a name=&quot;search&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;how-search-is-organized-in-hhru&quot;&gt;How search is organized in hh.ru&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;by Alexey Bichuk&lt;/em&gt;, &lt;a href=&quot;https://hh.ru/&quot;&gt;hh.ru&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Original article on &lt;a href=&quot;https://habr.com/company/hh/blog/413261/&quot;&gt;habr.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;What search is?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Find something &lt;strong&gt;relevant&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Support &lt;strong&gt;different queries&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Filter&lt;/strong&gt; by different parameters.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Ranking&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Hide&lt;/strong&gt; garbage from search result.&lt;/li&gt;
  &lt;li&gt;Do it &lt;strong&gt;fast&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;What are the existing solutions?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://lucene.apache.org/&quot;&gt;Lucene&lt;/a&gt; (we use it),&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/&quot;&gt;Elasticsearch&lt;/a&gt;,&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://sphinxsearch.com/&quot;&gt;Sphinx&lt;/a&gt;,&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://lucene.apache.org/solr/&quot;&gt;Solr&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Why Lucene?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Historical reasons:
    &lt;ul&gt;
      &lt;li&gt;there was no Elasticsearch on the market,&lt;/li&gt;
      &lt;li&gt;Solr was unstable,&lt;/li&gt;
      &lt;li&gt;Sphinx is not for Java.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Customizing.&lt;/li&gt;
  &lt;li&gt;Good community.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Lucene out-of-box is able to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;preprocess documents,&lt;/li&gt;
  &lt;li&gt;construct inverted index,&lt;/li&gt;
  &lt;li&gt;execute different queries,&lt;/li&gt;
  &lt;li&gt;segment index,&lt;/li&gt;
  &lt;li&gt;use basic ranking formulas,&lt;/li&gt;
  &lt;li&gt;use suggests, facets, counters, etc.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;General questions.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;How to search by similar words?
    &lt;ul&gt;
      &lt;li&gt;On indexing put synonym hash link close to original phrase.&lt;/li&gt;
      &lt;li&gt;Extend the query with synonyms.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;How keep all the things in memory?
    &lt;ul&gt;
      &lt;li&gt;Use sharding by:
        &lt;ul&gt;
          &lt;li&gt;types (vacancies, resumes, companies, …),&lt;/li&gt;
          &lt;li&gt;date (active vacancies, archive vacancies, …),&lt;/li&gt;
          &lt;li&gt;by id (inside the type).&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Load and fault tolerance.
    &lt;ul&gt;
      &lt;li&gt;95% queries must be done in less than 200ms.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;What is downtime?
    &lt;ul&gt;
      &lt;li&gt;20 HTTP 500 errors per second from frontend.&lt;/li&gt;
      &lt;li&gt;5% queries from frontend respond in more than 4s.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;How to reduce the load?
    &lt;ul&gt;
      &lt;li&gt;Put the most popular filters into the cache in form of byte mask (true if document match the filter).&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Ranking:
    &lt;ul&gt;
      &lt;li&gt;TF-IDF,&lt;/li&gt;
      &lt;li&gt;BM25.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Personalized ranking:
    &lt;ul&gt;
      &lt;li&gt;deal with empty queries,&lt;/li&gt;
      &lt;li&gt;tag resumes and vacancies.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;How to deal with timeouts?
    &lt;ul&gt;
      &lt;li&gt;Retry policy.&lt;/li&gt;
      &lt;li&gt;Speculative timeouts.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;ML in search:
    &lt;ul&gt;
      &lt;li&gt;user saw vacancy in search,&lt;/li&gt;
      &lt;li&gt;clicked on vacancy,&lt;/li&gt;
      &lt;li&gt;added in favourites,&lt;/li&gt;
      &lt;li&gt;got response,&lt;/li&gt;
      &lt;li&gt;got response with invitation.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;How to withstand the ML load on prod?
    &lt;ul&gt;
      &lt;li&gt;Use model cascade:
        &lt;ul&gt;
          &lt;li&gt;620k vacancies,&lt;/li&gt;
          &lt;li&gt;heuristic filters - 100k,&lt;/li&gt;
          &lt;li&gt;linear filtering model - 30k,&lt;/li&gt;
          &lt;li&gt;XGBoost filtering model - 10k,&lt;/li&gt;
          &lt;li&gt;XGBoost ranking model - ~500 features.&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;How to measure quality of search?
    &lt;ul&gt;
      &lt;li&gt;Session success.&lt;/li&gt;
      &lt;li&gt;Average and absolute number of conversions.&lt;/li&gt;
      &lt;li&gt;Clicks on search results page (and number of page).&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;How to organize experiments with search?
    &lt;ul&gt;
      &lt;li&gt;Rebuild index (if necessary).&lt;/li&gt;
      &lt;li&gt;Use A/B testing - for 2 weeks on 5% users.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;how-to-deal-with-techdebt&quot;&gt;How to deal with techdebt&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;by Anton Potapov&lt;/em&gt;, &lt;a href=&quot;http://www.ingrammicrocloud.ru/&quot;&gt;Ingram Micro Cloud&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What is technical debt?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Сrutches, hacks, poor technologies, etc.&lt;/li&gt;
  &lt;li&gt;Build, check, static analysis, deployment.&lt;/li&gt;
  &lt;li&gt;Unit, integration, UI e2e (end-to-end) tests.&lt;/li&gt;
  &lt;li&gt;Documentation.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;What to do with it?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Nothing.&lt;/li&gt;
  &lt;li&gt;Don’t rewrite.&lt;/li&gt;
  &lt;li&gt;Rewrite.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Why to invest in techdebt?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;More benefits:
    &lt;ul&gt;
      &lt;li&gt;more improvements,&lt;/li&gt;
      &lt;li&gt;delivering is quicker,&lt;/li&gt;
      &lt;li&gt;quality is higher, performance or predictability,&lt;/li&gt;
      &lt;li&gt;ability to free up people to work on product features.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Less costs on:
    &lt;ul&gt;
      &lt;li&gt;development,&lt;/li&gt;
      &lt;li&gt;support,&lt;/li&gt;
      &lt;li&gt;usage.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;You have to have clear plan with concrete numbers and dates.&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;infrastructure-development-in-badoo&quot;&gt;Infrastructure development in Badoo&lt;/h2&gt;

&lt;p&gt;&lt;em&gt;by Anton Povarov&lt;/em&gt;, &lt;a href=&quot;https://badoo.com/&quot;&gt;Badoo&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the beginning of any startup:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;everything is growing,&lt;/li&gt;
  &lt;li&gt;business wants more,&lt;/li&gt;
  &lt;li&gt;long infrastructure issues appear (sharding, logs, metrics, visualization, open second data center, …).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;It’s better to delegate these issues to separate team called &lt;strong&gt;Platform&lt;/strong&gt;. Benefits are:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;consistency,&lt;/li&gt;
  &lt;li&gt;responsibility,&lt;/li&gt;
  &lt;li&gt;spend their 10 000 hours.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Platform:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Big features machinery.&lt;/li&gt;
  &lt;li&gt;C / C++ / Go.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Infrastructure:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Scripts collection.&lt;/li&gt;
  &lt;li&gt;Queues.&lt;/li&gt;
  &lt;li&gt;Photos.&lt;/li&gt;
  &lt;li&gt;Data migrations between DCs.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Tools:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Metrics: store and visualize.&lt;/li&gt;
  &lt;li&gt;Build.&lt;/li&gt;
  &lt;li&gt;Deploy.&lt;/li&gt;
  &lt;li&gt;Test.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://www.collaborativeclimate.com/blog/wp-content/uploads/2017/08/Ditch-Annoyance.jpg&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;p&gt;How to choose important?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Horizontal communications.&lt;/li&gt;
  &lt;li&gt;Focus on the result.&lt;/li&gt;
  &lt;li&gt;Continuous engineering feedback.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Project creation funnel.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Sources: collect issues, ideas, projects.&lt;/li&gt;
  &lt;li&gt;Involvement: find a customer.&lt;/li&gt;
  &lt;li&gt;Business ideas: what issue to solve?&lt;/li&gt;
  &lt;li&gt;Ready to dev: engineer project, resources.&lt;/li&gt;
  &lt;li&gt;Priorities: what to do now?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Platform issues are specific:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;long term projects,&lt;/li&gt;
  &lt;li&gt;the mistake price is really high,&lt;/li&gt;
  &lt;li&gt;you cannot just “write codes”,&lt;/li&gt;
  &lt;li&gt;launch is often difficult.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Who does it?&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Developer:
    &lt;ul&gt;
      &lt;li&gt;does kick off,&lt;/li&gt;
      &lt;li&gt;forms tech plan,&lt;/li&gt;
      &lt;li&gt;leads the project,&lt;/li&gt;
      &lt;li&gt;is responsible for the result!&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;It’s important to keep feedback cycle:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;clarity,&lt;/li&gt;
  &lt;li&gt;management of expectations.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Stages:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;What exactly will have been done?&lt;/li&gt;
  &lt;li&gt;When this feature will have been on prod?&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Retrospective:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;explain, why deadline shift has been occurred again.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;PR:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Tell about what you have done:
    &lt;ul&gt;
      &lt;li&gt;projects are long term,&lt;/li&gt;
      &lt;li&gt;changes are always “invisible” for the users by design.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Collect any feedback.&lt;/li&gt;
  &lt;li&gt;Tell, what you are going to do.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When to tell this? Always. What will you get? Confidence that problems are solved. And, as a result, new problems!&lt;/p&gt;

&lt;h3 id=&quot;summary-1&quot;&gt;Summary&lt;/h3&gt;

&lt;p&gt;Platform issues lifecycle:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Listen.&lt;/li&gt;
  &lt;li&gt;Involve.&lt;/li&gt;
  &lt;li&gt;Suggest a solution.&lt;/li&gt;
  &lt;li&gt;Have it done.&lt;/li&gt;
  &lt;li&gt;Tell about it.&lt;/li&gt;
  &lt;li&gt;Go to step 1.&lt;/li&gt;
&lt;/ol&gt;</content><author><name></name></author><summary type="html">HighLoad++ 2018</summary></entry><entry><title type="html">Are you smart enough to work in Yandex?</title><link href="http://localhost:4000/python/algorithms/2018/08/30/are-you-smart-enough-to-work-in-yandex.html" rel="alternate" type="text/html" title="Are you smart enough to work in Yandex?" /><published>2018-08-30T12:41:38+03:00</published><updated>2018-08-30T12:41:38+03:00</updated><id>http://localhost:4000/python/algorithms/2018/08/30/are-you-smart-enough-to-work-in-yandex</id><content type="html" xml:base="http://localhost:4000/python/algorithms/2018/08/30/are-you-smart-enough-to-work-in-yandex.html">&lt;h1 id=&quot;are-you-smart-enough-to-work-in-yandex&quot;&gt;Are you smart enough to work in Yandex?&lt;/h1&gt;

&lt;p&gt;Yandex is a large IT company. It was the first time I tried to attend it. I couldn’t even imagine that the interview consists of four sessions, each session is about one hour. You have to talk with four different people in four different places and solve lots of problems and answer the questions. In Yandex they used to write the codes on blank papers or just on the walls - this is very convinient. There are two major requirements you should carry about.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Use an existing programming language to write your codes. You can use any language you prefer, but it can’t be a pseudo language.&lt;/li&gt;
  &lt;li&gt;Your codes should be free of any compiler / interpreter errors.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The recipe of success is handling edge cases. The more problems you solve and the less syntax and / or logical mistakes you make, the higher you are.&lt;/p&gt;

&lt;p&gt;In Yandex they believe that you have to have basic algorithmic knowledges. If you do, you can do anything else. I’ve failed my first attempt to join Yandex and decided to share some of the problems I faced during the interview.&lt;/p&gt;

&lt;p&gt;The list of problems.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#vertical-line&quot;&gt;Vertical line&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#two-maximums&quot;&gt;Two maximums&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#zip-ints&quot;&gt;Zip ints&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#count-pairs&quot;&gt;Count pairs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#set-difference&quot;&gt;Set difference&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#fifo-queue&quot;&gt;FIFO queue&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#palindrome&quot;&gt;Palindrome&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#reverse-linked-list&quot;&gt;Reverse linked list&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#sum-of-diagonals&quot;&gt;Sum of diagonals&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;vertical-line&quot;&gt;Vertical line&lt;/h2&gt;

&lt;p&gt;For given set of two-dimensional points check if a vertical line deviding the points symmetrically exists or not.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;A pair of points &lt;code class=&quot;highlighter-rouge&quot;&gt;(X1, Y1)&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;(X2, Y2)&lt;/code&gt; can be devided by a vertical line symmetrically if the equations &lt;code class=&quot;highlighter-rouge&quot;&gt;X1 + X2 = C&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;Y1 = Y2&lt;/code&gt; are held. If we find the other pair for which &lt;code class=&quot;highlighter-rouge&quot;&gt;Y3 = Y4&lt;/code&gt; is true, but &lt;code class=&quot;highlighter-rouge&quot;&gt;X3 + X4 != C&lt;/code&gt;, we cannot devide this set of points by a vertical line symmetrically. And finnaly, if we don’t determine the constant &lt;code class=&quot;highlighter-rouge&quot;&gt;C&lt;/code&gt;, we can’t devide the set too.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;check&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;points&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;seen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;points&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;seen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;seen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This algorithm takes O(n) time, but uses additional memory. In the worst case, when all the &lt;code class=&quot;highlighter-rouge&quot;&gt;Y&lt;/code&gt;s are different, we will have a full copy of the source set of points requiring O(n) additional memory.&lt;/p&gt;

&lt;h2 id=&quot;two-maximums&quot;&gt;Two maximums&lt;/h2&gt;

&lt;p&gt;Find two maximums in unsorted array.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;We can simply scan the array and check each value. Don’t forget about corner cases.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_maxs&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;max1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max2&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;max1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max2&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;max2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;max1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max1&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;max2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max1&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;max1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;max2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;max2&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This algorithm takes O(n) time and O(1) additional memory.&lt;/p&gt;

&lt;h2 id=&quot;zip-ints&quot;&gt;Zip ints&lt;/h2&gt;

&lt;p&gt;For given array of non repeatable integers print a string of shortened sequences. For example, for array &lt;code class=&quot;highlighter-rouge&quot;&gt;[4, 1, 2, 6, 3, 9, 7]&lt;/code&gt; the output is &lt;code class=&quot;highlighter-rouge&quot;&gt;&quot;1-4,6-7,9&quot;&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;In order to find the sequences to compress it’s better to have the source array sorted. In a sequence for the previous element and for the current element the equation &lt;code class=&quot;highlighter-rouge&quot;&gt;current = previous + 1&lt;/code&gt; is held.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;zip_ints&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;''&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;sorted_values&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sorted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sorted_values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;zipped&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sorted_values&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:]:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;prev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;zipped&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f'&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;zipped&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f'&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;prev&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;zipped&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f'&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;zipped&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;f'&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;','&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zipped&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In Python built-in &lt;code class=&quot;highlighter-rouge&quot;&gt;sorted&lt;/code&gt; method uses the &lt;a href=&quot;https://en.wikipedia.org/wiki/Timsort&quot;&gt;Timsort&lt;/a&gt; algorithm to sort sequences. In the worst-case it takes O(n log n) time and O(n) additional space. Iteration through the sorted array takes O(n) time, thus the total time complexity of this algorithm is O(n log n).&lt;/p&gt;

&lt;h2 id=&quot;count-pairs&quot;&gt;Count pairs&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;B&lt;/code&gt; are sorted arrays. Count the pairs for which the equation &lt;code class=&quot;highlighter-rouge&quot;&gt;a + b = x&lt;/code&gt; is held.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;To solve the problem effectively, we have to scan both arrays in the same loop. The first array (&lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt;) we scan from the beginning down to the end (forward scan using &lt;code class=&quot;highlighter-rouge&quot;&gt;i&lt;/code&gt; as an index), the second one (&lt;code class=&quot;highlighter-rouge&quot;&gt;B&lt;/code&gt;) - from the end up to the beginning (backward scan using &lt;code class=&quot;highlighter-rouge&quot;&gt;j&lt;/code&gt; as an index). There are three possible cases.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;A[i] + B[j] &amp;lt; x&lt;/code&gt; - the sum is less then &lt;code class=&quot;highlighter-rouge&quot;&gt;x&lt;/code&gt; - we increase the sum by increasing the index &lt;code class=&quot;highlighter-rouge&quot;&gt;i&lt;/code&gt; (move forward along the &lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt; array).&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;A[i] + B[j] &amp;gt; x&lt;/code&gt; - the sum is more then &lt;code class=&quot;highlighter-rouge&quot;&gt;x&lt;/code&gt; - we decrease the sum by decreasing the index &lt;code class=&quot;highlighter-rouge&quot;&gt;j&lt;/code&gt; (move backward along the &lt;code class=&quot;highlighter-rouge&quot;&gt;B&lt;/code&gt; array).&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;A[i] + B[j] = x&lt;/code&gt; - the sum is equal to &lt;code class=&quot;highlighter-rouge&quot;&gt;x&lt;/code&gt; - we increase a count of found pairs. The number of increasing depends on the number of the same values placed together in &lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;B&lt;/code&gt; (sequences of the save values).&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;total&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;count_a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;count_a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;count_b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;count_b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;total&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_b&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;total&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The algorithm takes O(n+k) time and O(1) additional memory.&lt;/p&gt;

&lt;h2 id=&quot;set-difference&quot;&gt;Set difference&lt;/h2&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;B&lt;/code&gt; are sorted arrays. Find elements contained in &lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt; and not contained in &lt;code class=&quot;highlighter-rouge&quot;&gt;B&lt;/code&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;The problem is to find a set difference between &lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;B&lt;/code&gt;, but we have lists instead of sets. The lists are sorted, we can use that to find the result effectively.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set_diff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:])&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We start processing &lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;B&lt;/code&gt; from the beginnig. We compare current elements. If we find, that an element from &lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt; is less, we will include it to the answer. Otherwise we move current positions &lt;code class=&quot;highlighter-rouge&quot;&gt;i&lt;/code&gt; and &lt;code class=&quot;highlighter-rouge&quot;&gt;j&lt;/code&gt; forward.&lt;/p&gt;

&lt;p&gt;The loop terminates if all the elements from &lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;B&lt;/code&gt; are processed. If &lt;code class=&quot;highlighter-rouge&quot;&gt;B&lt;/code&gt; is shorter, we have to add to the answer the rest elements from &lt;code class=&quot;highlighter-rouge&quot;&gt;A&lt;/code&gt; starting from the current position.&lt;/p&gt;

&lt;p&gt;This algorithm takes O(n+k) time and O(1) additional memory.&lt;/p&gt;

&lt;h2 id=&quot;fifo-queue&quot;&gt;FIFO queue&lt;/h2&gt;

&lt;p&gt;Create a FIFO queue using two stacks.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;FIFO queue is a queue where the oldest (first) item is processed first. In Python we have no special class for stacks, we can use lists instead.&lt;/p&gt;

&lt;p&gt;The idea is to put incoming elements in the first stack. When the element is aquired, we have to turn the first stack and return an item from top of the second stack.&lt;/p&gt;

&lt;p&gt;We can create a simple class that implements queue interface.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;FifoQueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_instack&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_outstack&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;enqueue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_instack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;item&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;dequeue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_outstack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_turn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_outstack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_turn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_instack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)):&lt;/span&gt;
            &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_outstack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_instack&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The usage of the &lt;code class=&quot;highlighter-rouge&quot;&gt;FifoQueue&lt;/code&gt; class is simple. We have only 2 public methods. When we need to store data, the method &lt;code class=&quot;highlighter-rouge&quot;&gt;enqueue&lt;/code&gt; is used. When we need stored data back, we call the &lt;code class=&quot;highlighter-rouge&quot;&gt;dequeue&lt;/code&gt; method.&lt;/p&gt;

&lt;h2 id=&quot;palindrome&quot;&gt;Palindrome&lt;/h2&gt;

&lt;p&gt;Check wheather a string is a palindrome or not. Non-alphanumeric characters are ignored. Case insensitive.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;A palindrome - reading a word from left to right is equal reading a word from right to left. For example, ignoring the difference between uppercase and lowercase letters and skipping non-alphanumeric characters, the string &lt;code class=&quot;highlighter-rouge&quot;&gt;Abcba!&lt;/code&gt; is a palindrome, while the string &lt;code class=&quot;highlighter-rouge&quot;&gt;Hello&lt;/code&gt; is not.&lt;/p&gt;

&lt;p&gt;Whereas there is a beautiful recursive solution, it takes additional memory per each recursion call and is not so effective as an iteration-based one.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;is_palindrome&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isalnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isalnum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;continue&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;j&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;j&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This algorithm takes O(n) time and O(1) additional memory.&lt;/p&gt;

&lt;h2 id=&quot;reverse-linked-list&quot;&gt;Reverse linked list&lt;/h2&gt;

&lt;p&gt;Reverse given linked list.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;For that problem we need to define a new data type for linked list. For example, it may look like the following.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;typing&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NoReturn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Optional&lt;/span&gt;


&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__init__&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Any&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Optional&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Node'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NoReturn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;
        &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;next&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;next&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Class &lt;code class=&quot;highlighter-rouge&quot;&gt;Node&lt;/code&gt; defines a type for an item of the linked list. Each node has a payload (value of any type) and a pointer to the next node (the &lt;code class=&quot;highlighter-rouge&quot;&gt;next&lt;/code&gt; attribute). If the node has no next node, we call it a &lt;em&gt;tail&lt;/em&gt; node.&lt;/p&gt;

&lt;p&gt;Using this data structure, a regular python list &lt;code class=&quot;highlighter-rouge&quot;&gt;[1, 2, 3, 4, 5]&lt;/code&gt; can be represented like that.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;z&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tail&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;y&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;z&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;y&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is to reverse given linked list, i.e. make tail node a head for the new linked list.&lt;/p&gt;

&lt;p&gt;Usually we process such structures using iteration. For example, a function that prints linked list can be written like this.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;print_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;current&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;next&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Using such iteration pattern, we can walk through the list and swap the pointers of the two neighbour nodes.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;reverse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Node&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;previous&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;None&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;head&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;next&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;next&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;previous&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;previous&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;current&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;tmp&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;previous&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This algorithm makes changes &lt;em&gt;in-place&lt;/em&gt;, i.e. it modifies an existing list. We can accept such behaviour for the sake of taking O(n) time and requiring O(1) additional memory.&lt;/p&gt;

&lt;h2 id=&quot;sum-of-diagonals&quot;&gt;Sum of diagonals&lt;/h2&gt;

&lt;p&gt;Find the sum of the diagonals of the square matrix.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;In order to solve the problem, we need to sum all the diagonal elements. We call an element &lt;em&gt;diagonal&lt;/em&gt; if it’s row index and column index are the same. Obviously, the algorithm has to take O(n) time to find the sum.&lt;/p&gt;

&lt;p&gt;The first thing we should do is to understand how to process all the diagonal elements using only one loop iteration. For instance, let’s consider a square matrix of size &lt;code class=&quot;highlighter-rouge&quot;&gt;4&lt;/code&gt;.&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/img/matrix-4x4.png&quot; alt=&quot;Square matrix of size 4&quot; width=&quot;400px&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;As we can see, in that case the sum is (1 + 6 + 11 + 16) + (4 + 7 + 10 + 13) = 68. The indices (X, Y) of the diagonal 1-6-11-16 are changing together from 1 up to 4. For the other diagonal 4-7-10-13 row X-index is changing from 1 up to 4, whereas column Y-index is changing from 4 down to 1. Keeping this in mind, let’s try to build the first version of the algorithm.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_diagonal_sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;14&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;15&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_diagonal_sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For our sample matrix this algorithm returns 68 and takes O(n) time. Let’s consider another example.&lt;/p&gt;

&lt;p align=&quot;center&quot;&gt;
&lt;img src=&quot;/assets/img/matrix-3x3.png&quot; alt=&quot;Square matrix of size 3&quot; width=&quot;400px&quot; /&gt;
&lt;/p&gt;

&lt;p&gt;For that matrix the algorithm returns 30 instead of 25: central cell with value 5 is processed twice. Instead of making conditional check each loop iteration, we can subtract central cell before the result is returned.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_diagonal_sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;matrix&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;][&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, now the algorithm returns correct result. This solution takes O(n) time and O(1) additional memory. The algorithm works for any other edge cases, e.g. matrices of 1 element or empty matrices.&lt;/p&gt;</content><author><name></name></author><summary type="html">Are you smart enough to work in Yandex?</summary></entry><entry><title type="html">Managing tree-based data in SQL using async Python</title><link href="http://localhost:4000/python/asyncio/postgresql/2017/12/14/managing-tree-based-data-in-sql-using-async-python.html" rel="alternate" type="text/html" title="Managing tree-based data in SQL using async Python" /><published>2017-12-14T10:20:45+03:00</published><updated>2017-12-14T10:20:45+03:00</updated><id>http://localhost:4000/python/asyncio/postgresql/2017/12/14/managing-tree-based-data-in-sql-using-async-python</id><content type="html" xml:base="http://localhost:4000/python/asyncio/postgresql/2017/12/14/managing-tree-based-data-in-sql-using-async-python.html">&lt;h1 id=&quot;this-article-details-how-async-python-can-be-used-to-develop-a-simple-api-for-managing-tree-based-data-in-sql&quot;&gt;This article details how async Python can be used to develop a simple API for managing tree-based data in SQL.&lt;/h1&gt;

&lt;h2 id=&quot;intro&quot;&gt;Intro&lt;/h2&gt;

&lt;p&gt;Tree-based data has often been used to represent the parent-child relationships in the user
business processes. There are several well-known models for storing such hierarchical data,
for example &lt;a href=&quot;https://en.wikipedia.org/wiki/Adjacency_list&quot;&gt;adjacency list&lt;/a&gt;,
&lt;a href=&quot;https://en.wikipedia.org/wiki/Nested_set_model&quot;&gt;nested set&lt;/a&gt;,
&lt;a href=&quot;https://coderwall.com/p/lixing/closure-tables-for-browsing-trees-in-sql&quot;&gt;closure table&lt;/a&gt;, etc.
We do not discuss which the best one is, but trying to show how one of those models can be
implemented using Python.&lt;/p&gt;

&lt;h2 id=&quot;objectives&quot;&gt;Objectives&lt;/h2&gt;

&lt;p&gt;Let’s develop a simple system that allows user to leave comments. Now it doesn’t matter what
exactly the user can comment. The API being developed must satisfy the following most important
requirements.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The user has to be authorized in order to make other API calls.&lt;/li&gt;
  &lt;li&gt;There is a method to leave a new comment.&lt;/li&gt;
  &lt;li&gt;There is a method to search comments by content.&lt;/li&gt;
  &lt;li&gt;There is a method to retrieve a sub-tree of comment.&lt;/li&gt;
  &lt;li&gt;All the API calls speak JSON.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Let’s define some technical properties of our system. We would use&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;async Python as a backend to handle many concurrent users,&lt;/li&gt;
  &lt;li&gt;PostgreSQL to exploit its full text search,&lt;/li&gt;
  &lt;li&gt;SQLAlchemy to construct SQL queries,&lt;/li&gt;
  &lt;li&gt;Swagger UI as a demonstration GUI for our API.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;closure-table&quot;&gt;Closure table&lt;/h2&gt;

&lt;p&gt;We would use a combination of closure table and adjacency list models. Closure table model
usually requires two tables to declare.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sqlalchemy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;
 
&lt;span class=&quot;n&quot;&gt;meta&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MetaData&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
 
&lt;span class=&quot;n&quot;&gt;comments&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'comments_comments'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;primary_key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'content'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nullable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 
&lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'comments_tree'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;meta&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;primary_key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'ancestor_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ForeignKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nullable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'nearest_ancestor_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ForeignKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nullable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'descendant_id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ForeignKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nullable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Column&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'depth'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Integer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nullable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;So far we have declared the &lt;strong&gt;comments&lt;/strong&gt; table to store user comments, and the &lt;strong&gt;comments_tree&lt;/strong&gt;
table to store parent-child comment relationships. Each row in the second one is a relation
between two comments. The columns have the following meaning:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;ancestor_id&lt;/em&gt; is an id of the parent comment. It might be not a direct parent, it may be a grand parent or a grand-grand parent for instance. Each comment is an ancestor of itself at the same depth.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;descendant_id&lt;/em&gt; is an id of a child comment.&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;depth&lt;/em&gt; is a level describing how deep in the tree the comment is. All the root comments have zero depth.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;However, this closure table contains only a plain info about data relations and doesn’t allow
to restore the ordered tree structure. To make it possible we will add an additional column.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;nearest_ancestor_id&lt;/em&gt; is an id of the direct parent of a comment.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Now it’s possible to reproduce an ordered tree structure using info about a relation between a
comment and its direct parent.&lt;/p&gt;

&lt;p&gt;Let’s see how to fill out these tables by example. To create the first comment we’re just putting
a text into &lt;em&gt;comments&lt;/em&gt; table.&lt;/p&gt;

&lt;style type=&quot;text/css&quot;&gt;
.comments-structure-tbl  {border-collapse:collapse;border-spacing:0;margin:0px auto;}
.comments-tbl  {border-collapse:collapse;border-spacing:0;border-color:#aaa;margin:0px auto;}
.comments-tbl td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;}
.comments-tbl th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;}
.comments-tbl .tg-first{vertical-align:top}
.comments-tree-tbl  {border-collapse:collapse;border-spacing:0;border-color:#999;border:none;margin:0px auto;}
.comments-tree-tbl td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#999;color:#444;background-color:#F7FDFA;}
.comments-tree-tbl th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:0px;overflow:hidden;word-break:normal;border-color:#999;color:#fff;background-color:#26ADE4;}
.comments-tree-tbl .tg-second{background-color:#D2E4FC;text-align:right;vertical-align:top}
.comments-tree-tbl .tg-first{text-align:right;vertical-align:top}
.comments-tree-tbl .tg-header{vertical-align:top}
&lt;/style&gt;

&lt;table class=&quot;comments-tbl&quot;&gt;
&lt;tbody&gt;
	&lt;tr&gt;
		&lt;th class=&quot;tg-first&quot;&gt;id&lt;/th&gt;
		&lt;th class=&quot;tg-first&quot;&gt;content&lt;/th&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
	    &lt;td class=&quot;tg-first&quot;&gt;1&lt;/td&gt;
	    &lt;td class=&quot;tg-first&quot;&gt;Can anybody explain me the difference between Bitcoin and Etherium?&lt;/td&gt;
	&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;We would also mark that comment as a parent (or ancestor) of itself.&lt;/p&gt;

&lt;table class=&quot;comments-tree-tbl&quot;&gt;
&lt;tbody&gt;
	&lt;tr&gt;
		&lt;th class=&quot;tg-header&quot;&gt;id&lt;/th&gt;
		&lt;th class=&quot;tg-header&quot;&gt;ancestor_id&lt;/th&gt;
		&lt;th class=&quot;tg-header&quot;&gt;nearest_ancestor_id&lt;/th&gt;
		&lt;th class=&quot;tg-header&quot;&gt;descendant_id&lt;/th&gt;
		&lt;th class=&quot;tg-header&quot;&gt;depth&lt;/th&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
	    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;0&lt;/td&gt;
	&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;To create a child comment we additionally put a relation with its grand parent (a non direct
ancestor with non-zero depth). The tables are changed as shown below.&lt;/p&gt;

&lt;table class=&quot;comments-tbl&quot;&gt;
&lt;tbody&gt;
	&lt;tr&gt;
		&lt;th class=&quot;tg-first&quot;&gt;id&lt;/th&gt;
		&lt;th class=&quot;tg-first&quot;&gt;content&lt;/th&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td class=&quot;tg-first&quot;&gt;1&lt;/td&gt;
		&lt;td class=&quot;tg-first&quot;&gt;Can anybody explain me the difference between Bitcoin and Etherium?&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
		&lt;td class=&quot;tg-first&quot;&gt;I'm sure no one can.&lt;/td&gt;
	&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;table class=&quot;comments-tree-tbl&quot;&gt;
&lt;tbody&gt;
	&lt;tr&gt;
		&lt;th class=&quot;tg-header&quot;&gt;id&lt;/th&gt;
		&lt;th class=&quot;tg-header&quot;&gt;ancestor_id&lt;/th&gt;
		&lt;th class=&quot;tg-header&quot;&gt;nearest_ancestor_id&lt;/th&gt;
		&lt;th class=&quot;tg-header&quot;&gt;descendant_id&lt;/th&gt;
		&lt;th class=&quot;tg-header&quot;&gt;depth&lt;/th&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;0&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
		&lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
		&lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
		&lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
		&lt;td class=&quot;tg-first&quot;&gt;1&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td class=&quot;tg-second&quot;&gt;3&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;2&lt;/td&gt;
		&lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
	&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Now we can see that the number of the relations and the depth are growing together. This is why
the closure table model has often been criticized. Obviously, in order to add an element with high
depth value to the tree, we will have to store lots of relations of the element and all its
ancestors.&lt;/p&gt;

&lt;p&gt;But it is not as bad as it seems. In a real case adding an element with a depth of 200 or 1000 may
not affect the performance of a server in a serious way. In fact, such a situation probably will
never happen (except when we are commenting the news about our national team losing a soccer
match). In many cases, the time of data selection is more significant then the insertion time.&lt;/p&gt;

&lt;p&gt;Back to our example. The full comment branch is looking like that.&lt;/p&gt;

&lt;table class=&quot;comments-structure-tbl&quot;&gt;
&lt;tbody&gt;
	&lt;tr&gt;
		&lt;td&gt;1&lt;/td&gt;
		&lt;td&gt;&amp;nbsp; Can anybody explain me the difference between Bitcoin and Etherium?&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td&gt;2&lt;/td&gt;
	    &lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; I'm sure no one can.&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td&gt;6&lt;/td&gt;
		&lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Why are you so sure?&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
	    &lt;td&gt;7&lt;/td&gt;
	    &lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; This is a blog about cooking!&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
	    &lt;td&gt;3&lt;/td&gt;
	    &lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; The same request.&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
	    &lt;td&gt;4&lt;/td&gt;
	    &lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; No problem, I'll give an explanation paper later.&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
	    &lt;td&gt;5&lt;/td&gt;
	    &lt;td&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Send me it by email then.&lt;/td&gt;
	&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;Let’s see how this branch will be represented in the tables.&lt;/p&gt;

&lt;table class=&quot;comments-tbl&quot;&gt;
&lt;tbody&gt;
&lt;tr&gt;
    &lt;th class=&quot;tg-first&quot;&gt;id&lt;/th&gt;
    &lt;th class=&quot;tg-first&quot;&gt;content&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;Can anybody explain me the difference between Bitcoin and Etherium?&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;I'm sure no one can.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;3&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;The same request.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;4&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;No problem, I'll give an explanation paper later.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;5&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;Send me it by email then.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;6&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;Why are you so sure?&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;7&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;This is a blog about cooking!&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;table class=&quot;comments-tree-tbl&quot;&gt;
&lt;tbody&gt;
&lt;tr&gt;
    &lt;th class=&quot;tg-header&quot;&gt;id&lt;/th&gt;
    &lt;th class=&quot;tg-header&quot;&gt;ancestor_id&lt;/th&gt;
    &lt;th class=&quot;tg-header&quot;&gt;nearest_ancestor_id&lt;/th&gt;
    &lt;th class=&quot;tg-header&quot;&gt;descendant_id&lt;/th&gt;
    &lt;th class=&quot;tg-header&quot;&gt;depth&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;0&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-second&quot;&gt;3&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;2&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;4&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;3&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;3&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;3&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-second&quot;&gt;5&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;3&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;6&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;4&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;4&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;4&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-second&quot;&gt;7&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;4&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;8&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;5&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;5&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;5&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-second&quot;&gt;9&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;4&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;4&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;5&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;10&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;4&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;5&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-second&quot;&gt;11&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;6&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;6&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;6&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;12&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;6&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-second&quot;&gt;13&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;2&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;6&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;2&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;14&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;7&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;7&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;7&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-second&quot;&gt;15&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;6&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;6&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;7&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-first&quot;&gt;16&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;2&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;6&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;7&lt;/td&gt;
    &lt;td class=&quot;tg-first&quot;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;td class=&quot;tg-second&quot;&gt;17&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;1&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;6&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;7&lt;/td&gt;
    &lt;td class=&quot;tg-second&quot;&gt;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;As it shown above, there is a root comment with zero depth within the branch and the max depth
(or level) of comments is 3. Now let’s see how we can deal with these tables in Python using
SQLAlchemy.&lt;/p&gt;

&lt;h2 id=&quot;sql-queries&quot;&gt;SQL queries&lt;/h2&gt;

&lt;h3 id=&quot;inserting-a-node-to-the-tree&quot;&gt;Inserting a node to the tree&lt;/h3&gt;

&lt;p&gt;Filling &lt;em&gt;comments_tree&lt;/em&gt; table can be done by using SQL
&lt;a href=&quot;https://www.w3schools.com/sql/sql_insert_into_select.asp&quot;&gt;INSERT INTO SELECT&lt;/a&gt; statement.
Using SQLAlchemy it can be written like shown below.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sqlalchemy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;
 
&lt;span class=&quot;n&quot;&gt;ancestor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'ancestor'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'descendant'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;nearest&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'nearest'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 
&lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;nearest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nearest_ancestor_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ancestor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;nearest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;depth&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;and_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parent_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ancestor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comment_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;nearest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parent_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;nearest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parent_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ins&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;from_select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nearest_ancestor_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;depth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;],&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;That code produces the following SQL query.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;INTO&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nearest_ancestor_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;depth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;nearest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nearest_ancestor_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;ancestor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;nearest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;depth&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nearest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ancestor&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARENT_ID&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ancestor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;COMMENT_ID&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nearest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARENT_ID&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nearest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PARENT_ID&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;selecting-a-sub-tree&quot;&gt;Selecting a sub-tree&lt;/h3&gt;

&lt;p&gt;Selecting the whole comment branch can be done like that.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sqlalchemy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;
 
&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nearest_ancestor_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;]).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;select_from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comment_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The corresponding SQL query.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nearest_ancestor_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_comments&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;JOIN&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ON&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;COMMENT_ID&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;deleting-a-sub-tree&quot;&gt;Deleting a sub-tree&lt;/h3&gt;

&lt;p&gt;To delete a comment and all its sub-comments we have to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;figure out and remove all the relations in which the target comment is involved (meaning it’s an ancestor or a nearest ancestor or a descendant),&lt;/li&gt;
  &lt;li&gt;remove all the comments for which the target comment is an ancestor.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Using SQLAlchemy we can write it like that.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sqlalchemy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;
 
&lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'remove'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;alias&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'descendant'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
 
&lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;and_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;or_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nearest_ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;comment_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;SQL query.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_tree&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;OR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nearest_ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;OR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;remove&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;descendant_id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;descendant&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ancestor_id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;COMMENT_ID&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;That query will select all the ids of  the comments (the first column) and all the ids of the
comment relations (the second column) we need to delete.&lt;/p&gt;

&lt;h2 id=&quot;the-details&quot;&gt;The details&lt;/h2&gt;

&lt;h3 id=&quot;schema-changes&quot;&gt;Schema changes&lt;/h3&gt;

&lt;p&gt;It’s most likely that we’ll want to show more info about comments, not only a text. For instance,
we may want to display a name of the author of the comment and the time when comment has been left.
It will cause the schema changes to be applied. We would probably want to use one of the database
schema management systems like
&lt;a href=&quot;http://sqlalchemy-migrate.readthedocs.io/en/latest/index.html&quot;&gt;SQLAlchemy Migrate&lt;/a&gt;
to simplify that.&lt;/p&gt;

&lt;h3 id=&quot;executing-sql&quot;&gt;Executing SQL&lt;/h3&gt;

&lt;p&gt;Due to async Python we would use &lt;a href=&quot;https://aiopg.readthedocs.io/en/stable/index.html&quot;&gt;aiopg&lt;/a&gt; to
operate upon PostgreSQL. We can init and shutdown a connection pool as shown below.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;aiopg.sa&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;aiohttp&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;
 
&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup_pg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;aiopg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create_engine&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DATABASE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'db'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;engine&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;close_pg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'db'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'db'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;wait_closed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;on_startup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setup_pg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;on_cleanup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close_pg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;full-text-search&quot;&gt;Full-text search&lt;/h3&gt;

&lt;p&gt;PostgreSQL supports full-text search, we can exploit it using SQLAlchemy.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sqlalchemy&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;sqlalchemy.sql.expression&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;
 
&lt;span class=&quot;n&quot;&gt;sel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cast&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plainto_tsquery&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'query text'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TEXT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;That will produce the following SQL query.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-sql&quot; data-lang=&quot;sql&quot;&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_comments&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;comments_comments&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@@&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to_tsquery&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;CAST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;plainto_tsquery&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'query text'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;TEXT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;This is a basic full-text search usage. For more complex examples see the links below.&lt;/p&gt;

&lt;h3 id=&quot;user-auth&quot;&gt;User auth&lt;/h3&gt;

&lt;p&gt;To avoid unauthorized access to the API we would require an auth token being passed as a
parameter to each call. We can use &lt;a href=&quot;https://en.wikipedia.org/wiki/JSON_Web_Token&quot;&gt;JSON Web Tokens&lt;/a&gt;
to implement that. To figure out how to use JWT in Python, follow the links below.&lt;/p&gt;

&lt;h3 id=&quot;swagger-ui&quot;&gt;Swagger UI&lt;/h3&gt;

&lt;p&gt;To provide a demonstration GUI for the API we can use
&lt;a href=&quot;http://aiohttp-swagger.readthedocs.io/en/latest/&quot;&gt;aiohttp-swagger&lt;/a&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-python&quot; data-lang=&quot;python&quot;&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;aiohttp&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;aiohttp_swagger&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;setup_swagger&lt;/span&gt;
 
&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;setup_swagger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;swagger_from_file&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'swagger.yaml'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;

&lt;p&gt;In this article we’ve developed a simple API that allows user to leave comments. We’ve learned
how to use a combination of closure table and adjacency list models to work with tree-based data.
The source code of the project is available in
&lt;a href=&quot;https://github.com/vyacheslav-bezborodov/closure-table&quot;&gt;the repository&lt;/a&gt; on GitHub.&lt;/p&gt;

&lt;h1 id=&quot;links&quot;&gt;Links&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://technobytz.com/closure_table_store_hierarchical_data.html&quot;&gt;http://technobytz.com/closure_table_store_hierarchical_data.html&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.postgresql.org/docs/9.5/static/textsearch.html&quot;&gt;https://www.postgresql.org/docs/9.5/static/textsearch.html&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://steelkiwi.com/blog/jwt-authorization-python-part-1-practise/&quot;&gt;https://steelkiwi.com/blog/jwt-authorization-python-part-1-practise/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name></name></author><summary type="html">This article details how async Python can be used to develop a simple API for managing tree-based data in SQL.</summary></entry></feed>